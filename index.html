<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>Cartas Poker - Con Autoavance</title>
    <script src="base64_images_data.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Arial', sans-serif;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 800px;
            width: 100%;
        }

        .title {
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }

        .phase-title {
            color: #666;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .section {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }

        .section-title {
            color: #333 !important;
            margin-bottom: 15px !important;
            font-size: 1.3rem !important;
            font-weight: bold !important;
        }
        
        /* Asegurar que todos los t√≠tulos de secci√≥n tengan el mismo tama√±o */
        h3.section-title {
            color: #333 !important;
            margin-bottom: 15px !important;
            font-size: 1.3rem !important;
            font-weight: bold !important;
        }
        
        /* Selector a√∫n m√°s espec√≠fico para garantizar consistencia */
        .section h3.section-title {
            color: #333 !important;
            margin-bottom: 15px !important;
            font-size: 1.3rem !important;
            font-weight: bold !important;
        }
        
        /* Forzar el tama√±o de fuente para todos los t√≠tulos de secci√≥n */
        h3[class*="section-title"] {
            color: #333 !important;
            margin-bottom: 15px !important;
            font-size: 1.3rem !important;
            font-weight: bold !important;
        }
        
        /* Selector de m√°xima especificidad */
        div.section > h3.section-title {
            color: #333 !important;
            margin-bottom: 15px !important;
            font-size: 1.3rem !important;
            font-weight: bold !important;
        }
        
        /* Selector de m√°xima especificidad para forzar el tama√±o */
        body div.section h3.section-title {
            color: #333 !important;
            margin-bottom: 15px !important;
            font-size: 1.3rem !important;
            font-weight: bold !important;
        }
        
        /* Selector ultra espec√≠fico para todos los elementos h3 en secciones */
        
        body * h3.section-title,
        body h3.section-title,
        html body h3.section-title {
            font-size: 1.3rem !important;
            font-weight: bold !important;
            color: #333 !important;
            margin-bottom: 15px !important;
        }

        .card-display {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .poker-card {
            width: 200px;
            height: 280px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .poker-card svg,
        .poker-card img {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .card-red {
            color: #dc3545;
        }

        .card-black {
            color: #333;
        }

        .card-input {
            width: 120px;
            height: 50px;
            border: 3px solid #ddd;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            background: #f8f9fa;
            color: #333;
            font-family: 'Courier New', monospace;
            transition: all 0.3s;
        }

        .card-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            transform: scale(1.05);
        }

        .card-input.correct {
            border-color: #28a745;
            background-color: #d4edda;
            color: #155724;
        }

        .card-input.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .card-number-select {
            width: 80px;
            height: 45px;
            border: 3px solid #ddd;
            border-radius: 8px 8px 0 0;
            font-size: 1.8rem;
            font-weight: bold;
            text-align: center;
            background: #f8f9fa;
            color: #333;
            font-family: 'Arial', sans-serif;
            transition: all 0.3s;
        }
        
        .card-number-select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            transform: scale(1.02);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .card-number-select.correct {
            border-color: #28a745;
            background-color: #d4edda;
            color: #155724;
        }
        
        .card-number-select.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }

        .button {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.2rem;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s;
        }

        .button:hover {
            transform: translateY(-2px);
        }

        .button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .hidden {
            display: none;
        }

        .timer {
            font-size: 1.2rem;
            color: #666;
            margin: 10px 0;
        }

        .progress-indicator {
            font-size: 1.1rem;
            color: #666;
            margin: 15px 0;
        }

        /* Fase de preparaci√≥n */
        .prep-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin: 20px 0;
        }
        .prep-circle {
            width: 260px;
            height: 260px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.08), rgba(255,255,255,0) 60%), #000000;
            box-shadow: 0 20px 40px rgba(0,0,0,0.25), inset 0 0 0 10px rgba(255,255,255,0.12);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            border: 6px solid rgba(255,255,255,0.18);
            animation: prepPulse 1.6s ease-in-out infinite;
        }
        .prep-circle::after {
            content: '';
            position: absolute;
            inset: -14px;
            border-radius: 50%;
            background: conic-gradient(from 0deg, rgba(255,255,255,0.35), rgba(255,255,255,0));
            filter: blur(8px);
            opacity: 0.5;
        }
        .prep-count {
            font-size: 6rem;
            font-weight: 900;
            color: #ffffff;
            text-shadow: 0 4px 16px rgba(0,0,0,0.35);
            line-height: 1;
        }
        .prep-subtitle {
            color: #000000;
            font-size: 1.2rem;
            opacity: 0.95;
        }
        @keyframes prepPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 20px 40px rgba(0,0,0,0.25), inset 0 0 0 10px rgba(255,255,255,0.12); }
            50% { transform: scale(1.03); box-shadow: 0 24px 48px rgba(0,0,0,0.3), inset 0 0 0 12px rgba(255,255,255,0.15); }
        }

        .result-message {
            font-size: 1.5rem;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
        }

        .correct-result {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .incorrect-result {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin: 20px 0;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        @media (max-width: 768px) {
            .cards-grid {
                gap: 8px;
                max-width: 100%;
            }
        }
        


        .card-input-row {
            display: flex;
            flex-direction: column;
            width: 100%;
            justify-content: center;
            align-items: center;
            gap: 0px;
            position: relative;
            margin: 8px 0;
        }
        
        /* Ajustes para el nuevo sistema de grid */
        .card-number-select {
            margin-bottom: 0;
        }
        
        .suit-select {
            margin-top: 0;
        }
 
        .card-input {
            width: 55px;
            height: 25px;
            border: 2px solid #ddd;
            border-radius: 6px 6px 0 0;
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            background: #f8f9fa;
            color: #333;
            font-family: 'Arial', sans-serif;
            transition: all 0.3s;
        }
 
        .suit-select {
            width: 80px;
            height: 45px;
            border: 2px solid #ddd;
            border-top: none;
            border-radius: 0 0 8px 8px;
            font-size: 1.8rem;
            background: white;
            color: #333;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            /* Eliminar estilos nativos del navegador m√≥vil */
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            /* Asegurar que no haya botones nativos */
            background-image: none;
            /* Mejorar la experiencia t√°ctil */
            touch-action: manipulation;
            /* Eliminar zoom en iOS */
            font-size: 16px;
        }

        .suit-select:focus {
            outline: none;
            border-color: #667eea;
            transform: scale(1.02);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .suit-select.correct {
            border-color: #28a745;
            background-color: #d4edda;
            color: #155724;
        }

        .suit-select.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }

        .suit-select option[value="P"] {
            color: #333 !important;
        }

        .suit-select option[value="C"] {
            color: #dc3545 !important;
        }

        .suit-select option[value="D"] {
            color: #dc3545 !important;
        }

        .suit-select option[value="T"] {
            color: #333 !important;
        }
        
        /* Eliminar completamente cualquier bot√≥n nativo en m√≥viles */
        .suit-select::-ms-expand {
            display: none;
        }
        
        .suit-select::-webkit-select-placeholder {
            color: #666;
        }
        
        /* Asegurar que no haya flechas o botones nativos */
        .suit-select {
            background-image: none !important;
            background: white !important;
        }
        
        /* Estilos espec√≠ficos para iOS */
        @supports (-webkit-touch-callout: none) {
            .suit-select {
                -webkit-appearance: none !important;
                appearance: none !important;
                background-image: none !important;
                border-radius: 0 0 8px 8px !important;
            }
        }
        
        /* Estilos espec√≠ficos para Android */
        @supports not (-webkit-touch-callout: none) {
            .suit-select {
                -webkit-appearance: none !important;
                -moz-appearance: none !important;
                appearance: none !important;
                background-image: none !important;
            }
        }
        
        /* Estilos adicionales para eliminar cualquier bot√≥n nativo */
        .suit-select {
            /* Eliminar flecha nativa en todos los navegadores */
            background: white !important;
            background-image: none !important;
            -webkit-appearance: none !important;
            -moz-appearance: none !important;
            appearance: none !important;
            /* Asegurar que el texto sea legible */
            font-size: 16px !important;
            /* Mejorar experiencia t√°ctil */
            touch-action: manipulation;
            /* Eliminar cualquier padding nativo */
            padding: 0 !important;
            margin: 0 !important;
        }
        
        /* Estilos para las opciones del selector */
        .suit-select option {
            background: white !important;
            color: inherit !important;
            font-size: 16px !important;
            padding: 8px !important;
        }
        
        /* Asegurar que los colores se muestren en m√≥viles */
        @media (max-width: 768px) {
            .suit-select option[value="P"] {
                color: #333 !important;
                background-color: white !important;
            }
            
            .suit-select option[value="C"] {
                color: #dc3545 !important;
                background-color: white !important;
            }
            
            .suit-select option[value="D"] {
                color: #dc3545 !important;
                background-color: white !important;
            }
            
            .suit-select option[value="T"] {
                color: #333 !important;
                background-color: white !important;
            }
            
            /* Asegurar que el texto seleccionado tenga el color correcto */
            .suit-select[data-selected="P"] {
                color: #333 !important;
            }
            
            .suit-select[data-selected="C"] {
                color: #dc3545 !important;
            }
            
            .suit-select[data-selected="D"] {
                color: #dc3545 !important;
            }
            
            .suit-select[data-selected="T"] {
                color: #333 !important;
            }
        }

        .fullscreen-button {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%) !important;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 1.2rem;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.2s;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            min-width: 40px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fullscreen-button:hover {
            transform: translateY(-2px);
        }

        /* Estilos para sistema de rondas */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border: 2px solid #e9ecef;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-number.correct {
            color: #28a745;
        }

        .stat-number.incorrect {
            color: #dc3545;
        }

        .stat-number.neutral {
            color: #6c757d;
        }

        .chart-container {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .pie-chart {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(#28a745 0deg, #28a745 0deg, #e9ecef 0deg);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .pie-chart-text {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }

        .chart-label {
            text-align: center;
            margin-top: 10px;
            font-weight: bold;
            color: #333;
        }

        .rounds-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .round-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 2px solid #e9ecef;
        }

        .round-item.correct {
            border-color: #28a745;
            background-color: #d4edda;
        }

        .round-item.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
        }

        /* Estilos para configuraci√≥n de tiempo en resultados */
        .mode-selector {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 15px 0;
        }

        .mode-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: white;
        }

        .mode-radio {
            margin: 0;
        }

        .timer-select {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            width: 120px;
        }

        .small-input {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            width: 80px;
        }

        /* Estilos para las cartas en fase de memorizaci√≥n */
        .poker-card {
            width: 200px;
            height: 280px;
            margin: 2px;
            display: inline-block;
            flex-shrink: 0;
            box-sizing: border-box;
        }
        
        .card-display {
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            gap: 2px;
            margin: 20px 0;
            flex-wrap: nowrap !important;
            flex-direction: row !important;
            overflow-x: auto;
            min-height: 300px;
            width: 100%;
            /* Asegurar que las cartas siempre se mantengan en horizontal */
            max-width: 100vw;
            padding: 0 10px;
        }
        
        /* Forzar comportamiento horizontal en todos los dispositivos */
        .card-display > .poker-card {
            display: inline-block !important;
            float: none !important;
            vertical-align: top !important;
            box-sizing: border-box !important;
            /* Asegurar que nunca se apilen verticalmente */
            flex-shrink: 0 !important;
            flex-grow: 0 !important;
        }
        
        /* Asegurar que todas las cartas tengan el mismo tama√±o */
        .poker-card > div {
            width: 100% !important;
            height: 100% !important;
            box-sizing: border-box !important;
        }
        
        @media (max-width: 768px) {
            .game-container {
                padding: 15px;
                max-width: 95%;
            }
            
            .card-display {
                flex-direction: row !important;
                flex-wrap: nowrap !important;
                gap: 2px !important;
                justify-content: center !important;
                align-items: center !important;
                min-height: 320px !important;
                padding: 0 10px !important;
            }
            
            .poker-card {
                width: 180px !important;
                height: 260px !important;
                margin: 2px !important;
                flex-shrink: 0 !important;
                display: inline-block !important;
            }
            
            .card-number-select {
                width: 60px;
                height: 35px;
                font-size: 1.2rem;
            }
            
            .suit-select {
                width: 60px;
                height: 35px;
                font-size: 1.2rem;
                /* Asegurar que el texto sea legible */
                font-size: 16px;
                padding: 0;
                margin: 0;
            }
        }
        
        @media (max-width: 480px) {
            .poker-card {
                width: 125px !important;
                height: 183px !important;
                margin: 2px !important;
            }
            
            .card-display {
                gap: 2px !important;
                min-height: 240px !important;
                padding: 0 10px !important;
            }
            
            /* Asegurar que las cartas siempre se mantengan en horizontal */
            .card-display > .poker-card {
                min-width: 125px !important;
                max-width: 125px !important;
            }
        }
        
        /* Estilos para pantallas muy peque√±as */
        @media (max-width: 360px) {
            .poker-card {
                width: 105px !important;
                height: 155px !important;
                margin: 2px !important;
            }
            
            .card-display {
                gap: 2px !important;
                min-height: 200px !important;
                padding: 0 10px !important;
            }
            
            .card-display > .poker-card {
                min-width: 105px !important;
                max-width: 105px !important;
            }
        }
            
            /* Mejorar selectores en pantallas muy peque√±as */
            .suit-select {
                width: 50px;
                height: 30px;
                font-size: 14px;
                padding: 0;
                margin: 0;
            }
            
            .card-number-select {
                width: 50px;
                height: 30px;
                font-size: 14px;
            }

        /* Estilos para cuadros adaptativos en modo cartas */
        .card-display.cards-mode {
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            gap: 20px !important;
            margin: 20px 0 !important;
            flex-wrap: nowrap !important;
            overflow-x: auto !important;
            min-height: 280px !important;
            height: 280px !important;
            width: 100% !important;
            max-width: 100vw !important;
            padding: 0 20px !important;
            box-sizing: border-box !important;
            line-height: 0 !important;
            font-size: 0 !important;
        }
        
        /* Estilos para cartas en modo cartas - se aplican siempre */
        .card-display.cards-mode .poker-card {
            width: 200px !important;
            height: 280px !important;
            margin: 0 !important;
            flex-shrink: 0 !important;
            display: inline-block !important;
            box-sizing: border-box !important;
            overflow: hidden !important;
            border-radius: 12px !important;
            background: white !important;
            min-width: 200px !important;
            min-height: 280px !important;
            max-width: 200px !important;
            max-height: 280px !important;
            aspect-ratio: 5/7 !important;
            contain: layout style paint !important;
            position: relative !important;
            isolation: isolate !important;
        }
        
        /* Estilos adicionales para asegurar consistencia en modo individual */
        .card-display.cards-mode .poker-card:only-child {
            width: 200px !important;
            height: 280px !important;
            min-width: 200px !important;
            min-height: 280px !important;
            max-width: 200px !important;
            max-height: 280px !important;
        }
        
        /* Asegurar que el contenedor mantenga el comportamiento correcto */
        .card-display.cards-mode {
            justify-content: center !important;
            align-items: center !important;
        }
        
        /* Forzar el mismo tama√±o para todas las cartas en modo cartas */
        .card-display.cards-mode .poker-card,
        .card-display.cards-mode .poker-card:first-child,
        .card-display.cards-mode .poker-card:last-child,
        .card-display.cards-mode .poker-card:nth-child(1),
        .card-display.cards-mode .poker-card:nth-child(2),
        .card-display.cards-mode .poker-card:nth-child(3),
        .card-display.cards-mode .poker-card:nth-child(4),
        .card-display.cards-mode .poker-card:nth-child(5),
        .card-display.cards-mode .poker-card:nth-child(6),
        .card-display.cards-mode .poker-card:nth-child(7),
        .card-display.cards-mode .poker-card:nth-child(8),
        .card-display.cards-mode .poker-card:nth-child(9),
        .card-display.cards-mode .poker-card:nth-child(10) {
            width: 200px !important;
            height: 280px !important;
            min-width: 200px !important;
            min-height: 280px !important;
            max-width: 200px !important;
            max-height: 280px !important;
            flex: 0 0 200px !important;
            flex-basis: 200px !important;
            flex-grow: 0 !important;
            flex-shrink: 0 !important;
            box-sizing: border-box !important;
            display: inline-block !important;
            vertical-align: top !important;
            contain: layout style paint !important;
        }
        
        /* Forzar que el contenedor interno tambi√©n tenga el mismo tama√±o */
        .card-display.cards-mode .poker-card > div {
            width: 200px !important;
            height: 280px !important;
            min-width: 200px !important;
            min-height: 280px !important;
            max-width: 200px !important;
            max-height: 280px !important;
            flex: 0 0 200px !important;
            flex-basis: 200px !important;
            flex-grow: 0 !important;
            flex-shrink: 0 !important;
            position: relative !important;
            overflow: hidden !important;
        }
        
        .card-display.cards-mode .poker-card > div {
            width: 100% !important;
            height: 100% !important;
            box-sizing: border-box !important;
            overflow: hidden !important;
            border-radius: 12px !important;
            position: relative !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        
        .card-display.cards-mode .poker-card img {
            width: 200px !important;
            height: 280px !important;
            object-fit: fill !important;
            border-radius: 12px !important;
            object-position: center !important;
            display: block !important;
            margin: 0 !important;
            padding: 0 !important;
            min-width: 200px !important;
            min-height: 280px !important;
            max-width: 200px !important;
            max-height: 280px !important;
            image-rendering: -webkit-optimize-contrast !important;
            image-rendering: crisp-edges !important;
            transform: scale(1) !important;
            transform-origin: center center !important;
            backface-visibility: hidden !important;
            -webkit-backface-visibility: hidden !important;
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            box-sizing: border-box !important;
            flex-shrink: 0 !important;
            flex-grow: 0 !important;
        }
        
        /* Forzar que el div contenedor tambi√©n tenga dimensiones exactas */
        .card-display.cards-mode .poker-card > div[style*="width: 100%"] {
            width: 200px !important;
            height: 280px !important;
            min-width: 200px !important;
            min-height: 280px !important;
            max-width: 200px !important;
            max-height: 280px !important;
        }
        
        /* Forzar que TODOS los divs contenedores tengan dimensiones exactas */
        .card-display.cards-mode .poker-card > div {
            width: 200px !important;
            height: 280px !important;
            min-width: 200px !important;
            min-height: 280px !important;
            max-width: 200px !important;
            max-height: 280px !important;
            box-sizing: border-box !important;
        }
        
        /* Responsive para cuadros adaptativos */
        @media (max-width: 768px) {
            .card-display.cards-mode {
                gap: 15px !important;
                min-height: 252px !important;
                height: 252px !important;
                padding: 0 15px !important;
            }
            
            .card-display.cards-mode .poker-card {
                width: 180px !important;
                height: 252px !important;
                min-width: 180px !important;
                min-height: 252px !important;
                max-width: 180px !important;
                max-height: 252px !important;
            }
            
            .card-display.cards-mode .poker-card:only-child {
                width: 180px !important;
                height: 252px !important;
                min-width: 180px !important;
                min-height: 252px !important;
                max-width: 180px !important;
                max-height: 252px !important;
            }
            
            .card-display.cards-mode .poker-card,
            .card-display.cards-mode .poker-card:first-child,
            .card-display.cards-mode .poker-card:last-child,
            .card-display.cards-mode .poker-card:nth-child(1),
            .card-display.cards-mode .poker-card:nth-child(2) {
                width: 180px !important;
                height: 252px !important;
                min-width: 180px !important;
                min-height: 252px !important;
                max-width: 180px !important;
                max-height: 252px !important;
                flex: 0 0 180px !important;
                flex-basis: 180px !important;
                flex-grow: 0 !important;
                flex-shrink: 0 !important;
            }
            
            .card-display.cards-mode .poker-card > div {
                width: 180px !important;
                height: 252px !important;
                min-width: 180px !important;
                min-height: 252px !important;
                max-width: 180px !important;
                max-height: 252px !important;
                flex: 0 0 180px !important;
                flex-basis: 180px !important;
                flex-grow: 0 !important;
                flex-shrink: 0 !important;
            }
            
            .card-display.cards-mode .poker-card img {
                width: 180px !important;
                height: 252px !important;
                min-width: 180px !important;
                min-height: 252px !important;
                max-width: 180px !important;
                max-height: 252px !important;
            }
            
            .card-display.cards-mode .poker-card > div {
                width: 180px !important;
                height: 252px !important;
                min-width: 180px !important;
                min-height: 252px !important;
                max-width: 180px !important;
                max-height: 252px !important;
                box-sizing: border-box !important;
            }
        }
        
        @media (max-width: 480px) {
            .card-display.cards-mode {
                gap: 10px !important;
                min-height: 210px !important;
                height: 210px !important;
                padding: 0 10px !important;
            }
            
            .card-display.cards-mode .poker-card {
                width: 150px !important;
                height: 210px !important;
                min-width: 150px !important;
                min-height: 210px !important;
                max-width: 150px !important;
                max-height: 210px !important;
            }
            
            .card-display.cards-mode .poker-card:only-child {
                width: 150px !important;
                height: 210px !important;
                min-width: 150px !important;
                min-height: 210px !important;
                max-width: 150px !important;
                max-height: 210px !important;
            }
            
            .card-display.cards-mode .poker-card,
            .card-display.cards-mode .poker-card:first-child,
            .card-display.cards-mode .poker-card:last-child,
            .card-display.cards-mode .poker-card:nth-child(1),
            .card-display.cards-mode .poker-card:nth-child(2) {
                width: 150px !important;
                height: 210px !important;
                min-width: 150px !important;
                min-height: 210px !important;
                max-width: 150px !important;
                max-height: 210px !important;
                flex: 0 0 150px !important;
                flex-basis: 150px !important;
                flex-grow: 0 !important;
                flex-shrink: 0 !important;
            }
            
            .card-display.cards-mode .poker-card > div {
                width: 150px !important;
                height: 210px !important;
                min-width: 150px !important;
                min-height: 210px !important;
                max-width: 150px !important;
                max-height: 210px !important;
                flex: 0 0 150px !important;
                flex-basis: 150px !important;
                flex-grow: 0 !important;
                flex-shrink: 0 !important;
            }
            
            .card-display.cards-mode .poker-card img {
                width: 150px !important;
                height: 210px !important;
                min-width: 150px !important;
                min-height: 210px !important;
                max-width: 150px !important;
                max-height: 210px !important;
            }
            
            .card-display.cards-mode .poker-card > div {
                width: 150px !important;
                height: 210px !important;
                min-width: 150px !important;
                min-height: 210px !important;
                max-width: 150px !important;
                max-height: 210px !important;
                box-sizing: border-box !important;
            }
        }
        
        @media (max-width: 360px) {
            .card-display.cards-mode {
                gap: 8px !important;
                min-height: 168px !important;
                height: 168px !important;
                padding: 0 8px !important;
            }
            
            .card-display.cards-mode .poker-card {
                width: 120px !important;
                height: 168px !important;
                min-width: 120px !important;
                min-height: 168px !important;
                max-width: 120px !important;
                max-height: 168px !important;
            }
            
            .card-display.cards-mode .poker-card:only-child {
                width: 120px !important;
                height: 168px !important;
                min-width: 120px !important;
                min-height: 168px !important;
                max-width: 120px !important;
                max-height: 168px !important;
            }
            
            .card-display.cards-mode .poker-card,
            .card-display.cards-mode .poker-card:first-child,
            .card-display.cards-mode .poker-card:last-child,
            .card-display.cards-mode .poker-card:nth-child(1),
            .card-display.cards-mode .poker-card:nth-child(2) {
                width: 120px !important;
                height: 168px !important;
                min-width: 120px !important;
                min-height: 168px !important;
                max-width: 120px !important;
                max-height: 168px !important;
                flex: 0 0 120px !important;
                flex-basis: 120px !important;
                flex-grow: 0 !important;
                flex-shrink: 0 !important;
            }
            
            .card-display.cards-mode .poker-card > div {
                width: 120px !important;
                height: 168px !important;
                min-width: 120px !important;
                min-height: 168px !important;
                max-width: 120px !important;
                max-height: 168px !important;
                flex: 0 0 120px !important;
                flex-basis: 120px !important;
                flex-grow: 0 !important;
                flex-shrink: 0 !important;
            }
            
            .card-display.cards-mode .poker-card img {
                width: 120px !important;
                height: 168px !important;
                min-width: 120px !important;
                min-height: 168px !important;
                max-width: 120px !important;
                max-height: 168px !important;
            }
            
            .card-display.cards-mode .poker-card > div {
                width: 120px !important;
                height: 168px !important;
                min-width: 120px !important;
                min-height: 168px !important;
                max-width: 120px !important;
                max-height: 168px !important;
                box-sizing: border-box !important;
            }
        }
        
        /* Estilos responsive para la tabla de resultados detallados */
        @media (max-width: 768px) {
            #detailed-card-results table {
                font-size: 0.8rem !important;
                width: 100% !important;
                min-width: 300px !important;
            }
            
            #detailed-card-results th,
            #detailed-card-results td {
                padding: 6px 4px !important;
                font-size: 0.75rem !important;
            }
            
            #detailed-card-results .poker-card {
                width: 50px !important;
                height: 70px !important;
                margin: 2px !important;
            }
            
            #detailed-card-results .poker-card > div {
                font-size: 0.8rem !important;
            }
            
            #detailed-card-results .poker-card > div > div:first-child {
                font-size: 0.7rem !important;
                margin-bottom: 2px !important;
            }
        }
        
        @media (max-width: 480px) {
            #detailed-card-results table {
                font-size: 0.7rem !important;
                min-width: 250px !important;
            }
            
            #detailed-card-results th,
            #detailed-card-results td {
                padding: 4px 2px !important;
                font-size: 0.65rem !important;
            }
            
            #detailed-card-results .poker-card {
                width: 45px !important;
                height: 63px !important;
                margin: 1px !important;
            }
            
            #detailed-card-results .poker-card > div {
                font-size: 0.7rem !important;
            }
            
            #detailed-card-results .poker-card > div > div:first-child {
                font-size: 0.6rem !important;
                margin-bottom: 1px !important;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <button class="fullscreen-button" id="fullscreen-btn" onclick="toggleFullscreen()" title="Pantalla Completa">‚õ∂</button>
        <h1 class="title">Cartas Poker</h1>
        
        <!-- Fase de Configuraci√≥n -->
        <div id="setup-phase">
            <h2 class="phase-title">Configuraci√≥n del Juego</h2>
            
                         <!-- Cartas a Memorizar -->
             <div class="section">
                 <h3 class="section-title">1. Configuraci√≥n de Cartas</h3>
                 
                 <!-- Selecci√≥n de Modo de Juego -->
                 <div style="margin-bottom: 25px;">
                     <p style="font-size: 1.1rem; color: #333; margin-bottom: 15px; font-weight: bold;">Elige el modo de juego:</p>
                     <div style="display: flex; justify-content: center; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
                         <div style="display: flex; align-items: center; gap: 10px; margin: 10px 0; padding: 15px; border: 2px solid #e9ecef; border-radius: 8px; background: white; min-width: 200px;">
                             <input type="radio" id="symbols-mode" name="game-mode" value="symbols" checked>
                             <label for="symbols-mode" style="font-weight: bold; color: #333;">Modo S√≠mbolos</label>
                             <span style="font-size: 0.9rem; color: #666;">(‚ô†‚ô•‚ô¶‚ô£)</span>
                         </div>
                         
                         <div style="display: flex; align-items: center; gap: 10px; margin: 10px 0; padding: 15px; border: 2px solid #e9ecef; border-radius: 8px; background: white; min-width: 200px;">
                             <input type="radio" id="cards-mode" name="game-mode" value="cards">
                             <label for="cards-mode" style="font-weight: bold; color: #333;">Modo Cartas</label>
                             <span style="font-size: 0.9rem; color: #666;">(Im√°genes reales)</span>
                         </div>
                     </div>
                 </div>
                 
                 <!-- Opciones de configuraci√≥n -->
                 <div style="margin-bottom: 20px;">
                     <p>Elige el tipo de memorizaci√≥n:</p>
                     <div style="display: flex; justify-content: center; gap: 20px; margin: 15px 0; flex-wrap: wrap;">
                         <div style="display: flex; align-items: center; gap: 10px;">
                             <input type="radio" id="specific-cards-mode" name="cards-mode" value="specific" checked>
                             <label for="specific-cards-mode">N√∫mero espec√≠fico de cartas:</label>
                             <input type="number" id="cards-input" class="card-input" min="1" max="52" value="" placeholder="5" style="width: 80px;">
                             <span style="font-size: 1.1rem; color: #333;">cartas</span>
                         </div>
                         
                         <div style="display: flex; align-items: center; gap: 10px;">
                             <input type="radio" id="full-decks-mode" name="cards-mode" value="decks">
                             <label for="full-decks-mode">Barajas completas:</label>
                             <input type="number" id="decks-input" class="card-input" min="1" max="10" value="" placeholder="1" style="width: 80px;">
                             <span style="font-size: 1.1rem; color: #333;">barajas</span>
                         </div>
                     </div>
                 </div>
                 
                 <p id="selected-info">Memorizar√°s 5 cartas espec√≠ficas (2 cartas por p√°gina)</p>
                 <p id="deck-info" style="font-size: 0.9rem; color: #666; margin-top: 5px;">Total disponible: 52 cartas √∫nicas</p>
                 <p id="cards-mode-info" style="font-size: 0.9rem; color: #1976d2; margin-top: 10px; font-weight: bold; display: none;">
                     üñºÔ∏è En modo cartas, las im√°genes se adaptar√°n exactamente al tama√±o de los cuadros de visualizaci√≥n. Todas las cartas tendr√°n el mismo tama√±o.
                 </p>
             </div>

            <!-- Configuraci√≥n de Visualizaci√≥n -->
            <div class="section">
                <h3 class="section-title">2. Configuraci√≥n de Visualizaci√≥n</h3>
                <p>Elige c√≥mo quieres ver las cartas durante la memorizaci√≥n:</p>
                <div style="display: flex; justify-content: center; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 10px; margin: 10px 0; padding: 15px; border: 2px solid #e9ecef; border-radius: 8px; background: white; min-width: 200px;">
                        <input type="radio" id="pairs-mode" name="display-mode" value="pairs" checked>
                        <label for="pairs-mode" style="font-weight: bold; color: #333;">Parejas (2 cartas por p√°gina)</label>
                        <span style="font-size: 0.9rem; color: #666;">(Recomendado)</span>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 10px; margin: 10px 0; padding: 15px; border: 2px solid #e9ecef; border-radius: 8px; background: white; min-width: 200px;">
                        <input type="radio" id="single-mode" name="display-mode" value="single">
                        <label for="single-mode" style="font-weight: bold; color: #333;">Individual (1 carta por p√°gina)</label>
                        <span style="font-size: 0.9rem; color: #666;">(M√°s f√°cil)</span>
                    </div>
                </div>
                <p id="display-info" style="font-size: 0.9rem; color: #666; margin-top: 10px;">Ver√°s las cartas en parejas de 2 por p√°gina.</p>
            </div>

            <!-- Configuraci√≥n de Temporizadores -->
            <div class="section">
                <h3 class="section-title">3. Configuraci√≥n de Temporizadores</h3>
                
                <div style="display: flex; justify-content: center; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 10px; margin: 10px 0;">
                                        <label for="recall-timer">Tiempo para recall (segundos):</label>
                <input type="number" id="recall-timer" style="padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;" min="1" max="3600" step="0.1" value="" placeholder="30">
                <div id="recall-time-conversion" style="font-size: 0.9rem; color: #666; margin-top: 5px;"></div>
                    </div>
                </div>
            </div>
            
            <!-- Configuraci√≥n de Rondas -->
            <div class="section">
                <h3 class="section-title">4. Configuraci√≥n de Rondas</h3>
                <p>Elige cu√°ntas rondas quieres jugar:</p>
                <div style="display: flex; justify-content: center; align-items: center; gap: 15px; margin: 20px 0;">
                    <input type="number" id="rounds-input" class="card-input" min="1" max="100" value="" placeholder="10">
                    <span style="font-size: 1.1rem; color: #333;">rondas</span>
                </div>
                <p id="rounds-info">Jugar√°s 10 rondas en total</p>
                <p id="rounds-config-info" style="font-size: 0.9rem; color: #1976d2; margin-top: 10px; font-weight: bold;">
                    üí° La configuraci√≥n de tiempo se mantendr√° predeterminada igual que la inicial en todas las rondas, pero podr√°s modificarla entre rondas si lo deseas. Si seleccionas autoavance, se mantendr√° marcado autom√°ticamente.
                </p>
            </div>

            <!-- Configuraci√≥n de Autoavance -->
            <div class="section">
                <h3 class="section-title">5. Configuraci√≥n de Tiempo de Memorizaci√≥n</h3>
                
                <div style="display: flex; justify-content: center; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 10px; margin: 10px 0;">
                        <input type="radio" id="memorization-mode" name="time-mode" value="memorization" checked>
                        <label for="memorization-mode">Tiempo para memorizaci√≥n (segundos):</label>
                        <input type="number" id="memorization-timer" style="padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;" min="1" max="999999" step="0.1" value="" placeholder="15">
                        <div id="memorization-time-conversion" style="font-size: 0.9rem; color: #666; margin-top: 5px;"></div>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 10px; margin: 10px 0;">
                        <input type="radio" id="auto-advance-mode" name="time-mode" value="auto-advance">
                        <label for="auto-advance-mode">Autoavance (segundos):</label>
                        <input type="number" id="auto-advance-time" style="font-size: 1rem; padding: 8px 12px; border: 2px solid #ddd; border-radius: 6px; text-align: center; width: 80px; margin: 0 10px;" min="0.1" max="60" step="0.1" value="" placeholder="3">
                    </div>
                </div>
                
                <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">
                    <span id="mode-description">El juego usar√° el tiempo de memorizaci√≥n configurado.</span>
                </p>
            </div>

            <!-- Resumen de Configuraci√≥n -->
            <div style="background: #e3f2fd; border-radius: 10px; padding: 20px; margin: 20px 0; border: 2px solid #bbdefb;" id="config-summary">
                <h3>Resumen de Configuraci√≥n</h3>
                <p id="summary-cards">Cartas: 5</p>
                <p id="summary-rounds">Rondas: 10</p>
                <p id="summary-timers">Temporizadores: Memorizaci√≥n 15s, Recall 30s</p>
                <p id="summary-mode">Modo: Tiempo de memorizaci√≥n</p>
                <p id="summary-randomization" style="color: #1976d2; font-weight: bold; margin-top: 10px;">üé≤ Cada ronda tendr√° cartas completamente diferentes y aleatorias</p>
            </div>
            
            <button class="button" onclick="startGame()">Comenzar Juego</button>
        </div>

        <!-- Fase de Preparaci√≥n -->
        <div id="preparation-phase" class="hidden">
            <h2 class="phase-title">Preparaci√≥n</h2>
            <div class="prep-wrapper">
                <div class="prep-circle">
                    <div class="prep-count" id="prep-countdown">5</div>
                </div>
                <div class="prep-subtitle"><strong>Prep√°rate, la memorizaci√≥n comienza en breve...</strong></div>
            </div>
        </div>

        <!-- Fase de Memorizaci√≥n -->
        <div id="memorization-phase" class="hidden">
            <h2 class="phase-title">Fase de Memorizaci√≥n</h2>
            <div class="timer" id="timer">Tiempo restante: 15 segundos</div>
            <div class="timer" id="elapsed-time" style="color: #1976d2; font-weight: bold;">Tiempo empleado: 0.0 segundos</div>
            
            <!-- Contenedor principal con posici√≥n fija para las cartas -->
            <div style="position: relative; margin: 20px 0;">
                <!-- Indicador de mazo simplificado -->
                <div id="deck-indicator" style="
                    position: absolute;
                    left: 30px;
                    top: 80px;
                    background: #e74c3c;
                    color: white;
                    padding: 15px;
                    border-radius: 50%;
                    font-weight: bold;
                    font-size: 1.8rem;
                    width: 60px;
                    height: 60px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    box-shadow: 0 3px 8px rgba(0,0,0,0.2);
                    display: none;
                    z-index: 10;
                ">
                    <span id="current-deck-indicator">1</span>
                </div>
                
                <!-- Contenedor de cartas en posici√≥n original -->
                <div style="width: 100%;">
            <div class="card-display" id="card-display"></div>
            <div class="progress-indicator" id="progress">Cartas 1-2 de 5</div>
            <div style="margin: 20px 0;">
                <button class="button" id="prev-btn" onclick="previousCards()" disabled>‚Üê Anterior</button>
                <button class="button" id="next-btn" onclick="nextCards()">Siguiente ‚Üí</button>
            </div>
            <p id="memorization-info">Memoriza estas cartas. Tienes 15 segundos.</p>
            <div style="margin: 30px 0;">
                <button class="button" id="finish-memorization-btn" onclick="finishMemorization()">Terminar Memorizaci√≥n</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fase de Escritura -->
        <div id="input-phase" class="hidden">
            <h2 class="phase-title">Escribe las Cartas</h2>
            <div class="timer" id="recall-timer-display">Tiempo restante: 30 segundos</div>
                             <p>Escribe las cartas que memorizaste:</p>
                 <p style="font-size: 0.9rem; color: #666; margin: 10px 0;">
                     <strong>Formato:</strong> Escribe la carta (ej: As, Rey, 10) y selecciona el palo del desplegable
                 </p>
                 <div id="cards-input-container" class="cards-grid"></div>
            <div>
                <button class="button" onclick="verifyCardAnswers()" id="verify-btn">Verificar Respuesta</button>
                <button class="button" onclick="showCardsAgain()" id="show-again-btn">Ver de Nuevo</button>
            </div>
        </div>

        <!-- Fase de Resultado -->
        <div id="result-phase" class="hidden">
            <h2 class="phase-title">Resultado Ronda <span id="current-round-display">1</span></h2>
            <div id="result-message"></div>
            
            <!-- Resultado de la Ronda Actual -->
            <div class="section">
                <h3 class="section-title">Resultado Ronda <span id="current-round-number">1</span></h3>
                
                <!-- Estad√≠sticas de la ronda -->
                <div class="stats-grid" id="round-stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Porcentaje de Acierto</div>
                        <div class="stat-number neutral" id="round-accuracy">0%</div>
                        <div style="font-size: 0.9rem; color: #666;">cartas correctas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Estado</div>
                        <div class="stat-number neutral" id="round-status">Pendiente</div>
                        <div style="font-size: 0.9rem; color: #666;">de la ronda</div>
                    </div>
                </div>
            </div>
            
            <!-- Progresi√≥n de Rondas -->
            <div class="section">
                <h3 class="section-title">Progresi√≥n de Rondas</h3>
                
                <!-- Lista simple de porcentajes por ronda -->
                <div id="rounds-percentage-list" style="margin: 20px 0; text-align: center;">
                    <!-- Aqu√≠ se mostrar√°n los porcentajes de cada ronda -->
                </div>
                
                <!-- Estad√≠sticas totales -->
                <div class="stats-grid" id="progress-stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Rondas Correctas</div>
                        <div class="stat-number neutral" id="current-score">0</div>
                        <div style="font-size: 0.9rem; color: #666;">de <span id="current-round">1</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Promedio Precisi√≥n</div>
                        <div class="stat-number neutral" id="current-percentage">0%</div>
                        <div style="font-size: 0.9rem; color: #666;">de cartas correctas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Mejor Racha</div>
                        <div class="stat-number neutral" id="current-streak">0</div>
                        <div style="font-size: 0.9rem; color: #666;">consecutivas</div>
                    </div>
                </div>
            </div>
            
            <!-- Configuraci√≥n de tiempo para siguiente ronda -->
            <div class="section">
                <h3 class="section-title">Configuraci√≥n para Siguiente Ronda</h3>
                
                <div class="mode-selector">
                    <div class="mode-option">
                        <input type="radio" id="result-memorization-mode" name="result-time-mode" value="memorization" class="mode-radio" checked>
                        <label for="result-memorization-mode">Tiempo para memorizaci√≥n (segundos):</label>
                        <input type="number" id="result-memorization-timer" class="timer-select" min="1" max="999999" step="0.1" value="" placeholder="15">
                        <div id="result-memorization-time-conversion" style="font-size: 0.9rem; color: #666; margin-top: 5px;"></div>
                    </div>
                    
                    <div class="mode-option">
                        <input type="radio" id="result-auto-advance-mode" name="result-time-mode" value="auto-advance" class="mode-radio">
                        <label for="result-auto-advance-mode">Autoavance (segundos):</label>
                        <input type="number" id="result-auto-advance-time" class="small-input" min="0.1" max="60" step="0.1" value="" placeholder="3">
                    </div>
                </div>
                
                <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">
                    <span id="result-mode-description">El juego usar√° el tiempo de memorizaci√≥n configurado.</span>
                </p>
            </div>
            
            <div id="round-progress">
                <p>Ronda <span id="round-number">1</span> de <span id="total-rounds">10</span></p>
                <div style="width: 100%; height: 20px; background: #e9ecef; border-radius: 10px; margin: 15px 0; overflow: hidden;">
                    <div style="height: 100%; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); transition: width 0.3s ease; width: 0%;" id="round-progress-fill"></div>
                </div>
            </div>
            <div>
                <button class="button" onclick="nextRound()" id="next-round-btn">Siguiente Ronda</button>
                <button class="button" onclick="resetGame()" id="new-game-btn">Nuevo Juego</button>
                <button class="button" onclick="goToMenu()" id="menu-btn" style="display: none;">Men√∫</button>
            </div>
        </div>
        
        <!-- Fase de Resultados Finales -->
        <div id="final-results-phase" class="hidden">
            <h2 class="phase-title">¬°Juego Completado!</h2>
            
            <!-- Gr√°ficas circulares principales -->
            <div class="chart-container">
                <div>
                    <div class="pie-chart" id="final-accuracy-chart">
                        <div class="pie-chart-text">0%</div>
                    </div>
                    <div class="chart-label">Precisi√≥n Final</div>
                </div>
                <div>
                    <div class="pie-chart" id="final-score-chart">
                        <div class="pie-chart-text">0/10</div>
                    </div>
                    <div class="chart-label">Progreso</div>
                </div>
                <div>
                    <div class="pie-chart" id="final-streak-chart">
                        <div class="pie-chart-text">0</div>
                    </div>
                    <div class="chart-label">Mejor Racha</div>
                </div>
            </div>
            
            <!-- Estad√≠sticas finales -->
            <div class="section">
                <h3 class="section-title">Estad√≠sticas Finales</h3>
                <div class="stats-grid" id="final-stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Puntuaci√≥n Total</div>
                        <div class="stat-number neutral" id="final-score">0/10</div>
                        <div style="font-size: 0.9rem; color: #666;">rondas correctas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Porcentaje Final</div>
                        <div class="stat-number neutral" id="final-percentage">0%</div>
                        <div style="font-size: 0.9rem; color: #666;">de precisi√≥n</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Mejor Racha</div>
                        <div class="stat-number neutral" id="final-streak">0</div>
                        <div style="font-size: 0.9rem; color: #666;">consecutivas</div>
                    </div>
                </div>
            </div>
            
            <!-- Desglose de rondas -->
            <div class="section">
                <h3 class="section-title">Desglose por Rondas</h3>
                <div class="rounds-grid" id="final-rounds-breakdown"></div>
            </div>
            
            <div>
                <button class="button" onclick="resetGame()" id="final-new-game-btn">Nuevo Juego</button>
                <button class="button" onclick="goToMenu()" id="final-menu-btn">Men√∫</button>
            </div>
        </div>
    </div>

    <script>
                 // Variables del juego
         let gameState = 'setup';
         let selectedCards = 5;
         let selectedDecks = 1;
         let cardsMode = 'specific'; // 'specific' o 'decks'
         let cardSequence = [];
         let currentCardIndex = 0;
         let timer = 0;
         let memorizationTime = 15;
         let recallTime = 30;
         let timerInterval;
         let recallTimerInterval;
         let memorizationStartTime = 0;
         let actualMemorizationTime = 0;
         
         // Variables para autoavance
         let autoAdvanceEnabled = false;
         let autoAdvanceTime = 3;
         let currentMode = 'memorization';
         
         // Variables para sistema de rondas
         let currentRound = 1;
         let totalRounds = 10;
         let roundScores = [];
         let totalScore = 0;
         
         // Variables para modo de visualizaci√≥n
         let displayMode = 'pairs'; // 'pairs' o 'single'

                 // Cartas de poker disponibles (con s√≠mbolos para mostrar, letras para input)
         const pokerCards = [
             'A‚ô†', 'A‚ô•', 'A‚ô¶', 'A‚ô£',
             'K‚ô†', 'K‚ô•', 'K‚ô¶', 'K‚ô£',
             'Q‚ô†', 'Q‚ô•', 'Q‚ô¶', 'Q‚ô£',
             'J‚ô†', 'J‚ô•', 'J‚ô¶', 'J‚ô£',
             '10‚ô†', '10‚ô•', '10‚ô¶', '10‚ô£',
             '9‚ô†', '9‚ô•', '9‚ô¶', '9‚ô£',
             '8‚ô†', '8‚ô•', '8‚ô¶', '8‚ô£',
             '7‚ô†', '7‚ô•', '7‚ô¶', '7‚ô£',
             '6‚ô†', '6‚ô•', '6‚ô¶', '6‚ô£',
             '5‚ô†', '5‚ô•', '5‚ô¶', '5‚ô£',
             '4‚ô†', '4‚ô•', '4‚ô¶', '4‚ô£',
             '3‚ô†', '3‚ô•', '3‚ô¶', '3‚ô£',
             '2‚ô†', '2‚ô•', '2‚ô¶', '2‚ô£'
         ];

        // Cartas con im√°genes reales (formato: [palo]_[valor])
        const realCards = [
            'spades_A', 'hearts_A', 'diamonds_A', 'clubs_A',
            'spades_K', 'hearts_K', 'diamonds_K', 'clubs_K',
            'spades_Q', 'hearts_Q', 'diamonds_Q', 'clubs_Q',
            'spades_J', 'hearts_J', 'diamonds_J', 'clubs_J',
            'spades_10', 'hearts_10', 'diamonds_10', 'clubs_10',
            'spades_9', 'hearts_9', 'diamonds_9', 'clubs_9',
            'spades_8', 'hearts_8', 'diamonds_8', 'clubs_8',
            'spades_7', 'hearts_7', 'diamonds_7', 'clubs_7',
            'spades_6', 'hearts_6', 'diamonds_6', 'clubs_6',
            'spades_5', 'hearts_5', 'diamonds_5', 'clubs_5',
            'spades_4', 'hearts_4', 'diamonds_4', 'clubs_4',
            'spades_3', 'hearts_3', 'diamonds_3', 'clubs_3',
            'spades_2', 'hearts_2', 'diamonds_2', 'clubs_2'
        ];

        // Funci√≥n para convertir carta con s√≠mbolos a formato de input
        function cardToInputFormat(card) {
            return card.replace('‚ô†', 'P').replace('‚ô•', 'C').replace('‚ô¶', 'D').replace('‚ô£', 'T');
        }

        // Funci√≥n para convertir input a carta con s√≠mbolos
        function inputToCardFormat(input) {
            return input.replace('P', '‚ô†').replace('C', '‚ô•').replace('D', '‚ô¶').replace('T', '‚ô£');
        }

        // Funci√≥n para normalizar valores del usuario (1 = A, 11 = J, 12 = Q, 13 = K)
        function normalizeUserValue(userValue) {
            const value = userValue.toLowerCase().trim();
            
            // Mapear valores num√©ricos a letras
            switch(value) {
                case '1': return 'a';
                case '11': return 'j';
                case '12': return 'q';
                case '13': return 'k';
                default: return value;
            }
        }
        
        // Funci√≥n para convertir c√≥digos de palos a iconos
        function suitCodeToIcon(suitCode) {
            switch(suitCode) {
                case 'P': return '‚ô†';
                case 'C': return '‚ô•';
                case 'D': return '‚ô¶';
                case 'T': return '‚ô£';
                default: return suitCode;
            }
        }

        // Funci√≥n para obtener valores esperados de una carta (n√∫mero y palo)
        function getExpectedUserValueFromImage(card) {
            // Obtener el modo de juego seleccionado
            const gameMode = document.querySelector('input[name="game-mode"]:checked').value;
            
            if (gameMode === 'symbols') {
                // Modo s√≠mbolos - extraer de s√≠mbolos Unicode
                const number = card.replace(/[‚ô†‚ô•‚ô¶‚ô£]/g, ''); // Remover s√≠mbolos para obtener n√∫mero
                const suit = card.replace(/[A-Z0-9]/g, ''); // Remover letras/n√∫meros para obtener palo
                
                // Mapear s√≠mbolos a c√≥digos de palo
                let suitCode = '';
                switch(suit) {
                    case '‚ô†': suitCode = 'P'; break; // Picas
                    case '‚ô•': suitCode = 'C'; break; // Corazones
                    case '‚ô¶': suitCode = 'D'; break; // Diamantes
                    case '‚ô£': suitCode = 'T'; break; // Tr√©boles
                    default: suitCode = suit;
                }
                
                return {
                    number: number,
                    suit: suitCode
                };
            } else {
                // Modo cartas - usar funci√≥n para cartas reales
                return getExpectedUserValueFromRealCard(card);
            }
        }

        // Funci√≥n para extraer informaci√≥n de una carta con imagen real
        function parseRealCard(cardName) {
            // Formato: [palo]_[valor]
            const parts = cardName.split('_');
            if (parts.length >= 2) {
                const suit = parts[0];
                const value = parts[1];
                return { suit, value };
            }
            return { suit: 'spades', value: 'A' };
        }

        // Funci√≥n para obtener la ruta de imagen de una carta real
        function getRealCardImagePath(cardName) {
            return `images/cartas_reales/${cardName}.png`;
        }

        // Funci√≥n para convertir carta real a formato de input
        function realCardToInputFormat(cardName) {
            const { suit, value } = parseRealCard(cardName);
            
            // Mapear palos a c√≥digos
            let suitCode = '';
            switch(suit) {
                case 'spades': suitCode = 'P'; break;
                case 'hearts': suitCode = 'C'; break;
                case 'diamonds': suitCode = 'D'; break;
                case 'clubs': suitCode = 'T'; break;
                default: suitCode = 'P';
            }
            
            return { number: value, suit: suitCode };
        }

        // Funci√≥n para obtener valores esperados de una carta real
        function getExpectedUserValueFromRealCard(cardName) {
            return realCardToInputFormat(cardName);
        }

        // Funci√≥n para generar el patr√≥n de una carta seg√∫n su valor usando im√°genes reales
        function generateCardPattern(value, suitSymbol, suitColor) {
            const displayValue = value.toUpperCase();
            
            // Cartas especiales (A, K, Q, J)
            if (['A', 'K', 'Q', 'J'].includes(displayValue)) {
                return generateSpecialCardImage(displayValue, suitSymbol, suitColor);
            }
            
            // Cartas num√©ricas (2-10)
            const numValue = parseInt(value);
            if (numValue >= 2 && numValue <= 10) {
                return generateNumberCardImage(numValue, suitSymbol, suitColor);
            }
            
            // Fallback para valores desconocidos
            return generateSimpleCardImage(displayValue, suitSymbol, suitColor);
        }

        // Funci√≥n para generar cartas especiales (A, K, Q, J) usando im√°genes reales
        function generateSpecialCardImage(value, suitSymbol, suitColor) {
            // Mapear palos a nombres de archivo
            let suitName = '';
            switch(suitSymbol) {
                case '‚ô†': suitName = 'spades'; break;
                case '‚ô•': suitName = 'hearts'; break;
                case '‚ô¶': suitName = 'diamonds'; break;
                case '‚ô£': suitName = 'clubs'; break;
                default: suitName = 'spades';
            }
            
            // Crear clave para buscar la imagen
            const imageKey = `custom_${value}_${suitName}`;
            const imageSrc = CARD_IMAGES_BASE64[imageKey];
            
            if (imageSrc) {
                return `
                    <div style="
                        width: 100%; 
                        height: 100%; 
                        background: white;
                        border-radius: 12px;
                        overflow: hidden;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        position: relative;
                    ">
                        <img src="${imageSrc}" 
                             alt="${value} of ${suitName}" 
                             style="
                                 width: 200px; 
                                 height: 280px; 
                                 object-fit: fill;
                                 border-radius: 11px;
                                 object-position: center;
                                 display: block;
                                 margin: 0;
                                 padding: 0;
                                 min-width: 200px;
                                 min-height: 280px;
                                 max-width: 200px;
                                 max-height: 280px;
                                 image-rendering: -webkit-optimize-contrast;
                                 image-rendering: crisp-edges;
                                 position: absolute;
                                 top: 0;
                                 left: 0;
                             "
                             onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\'color: #666; font-size: 1.2rem;\'>Error cargando imagen</div>'">
                    </div>
                `;
            } else {
                // Fallback si no se encuentra la imagen - usar el mismo tama√±o que las cartas de s√≠mbolos
                const isMobile = window.innerWidth <= 768;
                const mainFontSize = isMobile ? '2.5rem' : '4rem';
                
                return `
                    <div style="
                        width: 100%; 
                        height: 100%; 
                        background: white;
                        border-radius: 12px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: ${suitColor};
                        font-size: ${mainFontSize};
                        font-weight: bold;
                    ">${value}</div>
                `;
            }
        }

        // Funci√≥n para generar cartas num√©ricas (2-10) usando im√°genes reales
        function generateNumberCardImage(numValue, suitSymbol, suitColor) {
            // Mapear palos a nombres de archivo
            let suitName = '';
            switch(suitSymbol) {
                case '‚ô†': suitName = 'spades'; break;
                case '‚ô•': suitName = 'hearts'; break;
                case '‚ô¶': suitName = 'diamonds'; break;
                case '‚ô£': suitName = 'clubs'; break;
                default: suitName = 'spades';
            }
            
            // Crear clave para buscar la imagen
            const imageKey = `custom_${numValue}_${suitName}`;
            const imageSrc = CARD_IMAGES_BASE64[imageKey];
            
            if (imageSrc) {
                return `
                    <div style="
                        width: 100%; 
                        height: 100%; 
                        background: white;
                        border-radius: 12px;
                        overflow: hidden;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        position: relative;
                    ">
                        <img src="${imageSrc}" 
                             alt="${numValue} of ${suitName}" 
                             style="
                                 width: 200px; 
                                 height: 280px; 
                                 object-fit: fill;
                                 border-radius: 11px;
                                 object-position: center;
                                 display: block;
                                 margin: 0;
                                 padding: 0;
                                 min-width: 200px;
                                 min-height: 280px;
                                 max-width: 200px;
                                 max-height: 280px;
                                 image-rendering: -webkit-optimize-contrast;
                                 image-rendering: crisp-edges;
                                 position: absolute;
                                 top: 0;
                                 left: 0;
                             "
                             onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\'color: #666; font-size: 1.2rem;\'>Error cargando imagen</div>'">
                    </div>
                `;
            } else {
                // Fallback si no se encuentra la imagen - usar el mismo tama√±o que las cartas de s√≠mbolos
                const isMobile = window.innerWidth <= 768;
                const mainFontSize = isMobile ? '2.5rem' : '4rem';
                
                return `
                    <div style="
                        width: 100%; 
                        height: 100%; 
                        background: white;
                        border-radius: 12px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: ${suitColor};
                        font-size: ${mainFontSize};
                        font-weight: bold;
                    ">${numValue}</div>
                `;
            }
        }

                 // Funci√≥n para generar carta simple (fallback) usando im√°genes reales
         function generateSimpleCardImage(value, suitSymbol, suitColor) {
             const isMobile = window.innerWidth <= 768;
             const mainFontSize = isMobile ? '2.5rem' : '4rem';
             
             return `
                 <div style="
                     width: 100%; 
                     height: 100%; 
                     background: white;
                     border-radius: 12px;
                     display: flex;
                     align-items: center;
                     justify-content: center;
                     color: ${suitColor};
                     font-size: ${mainFontSize};
                     font-weight: bold;
                 ">${value}</div>
             `;
         }

        // Funci√≥n para mezclar array de forma m√°s aleatoria (Fisher-Yates shuffle)
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Funci√≥n para verificar integridad de las cartas
        function verifyCardIntegrity() {
            const gameMode = document.querySelector('input[name="game-mode"]:checked').value;
            const sourceArray = gameMode === 'symbols' ? pokerCards : realCards;
            
            // Verificar que tenemos exactamente 52 cartas √∫nicas en el mazo base
            const uniqueSourceCards = new Set(sourceArray);
            if (uniqueSourceCards.size !== 52) {
                console.error('ERROR: El mazo base no tiene 52 cartas √∫nicas');
                console.log('Cartas duplicadas en mazo base:', sourceArray.filter((item, index) => sourceArray.indexOf(item) !== index));
                return false;
            }
            
            console.log(`‚úÖ Mazo base verificado: ${uniqueSourceCards.size} cartas √∫nicas`);
            return true;
        }

        // Funci√≥n para generar secuencia de cartas
        function generateCardSequence() {
            cardSequence = [];
            
            // Verificar integridad del mazo base
            if (!verifyCardIntegrity()) {
                console.error('No se puede generar secuencia debido a errores en el mazo base');
                return;
            }
            
            if (cardsMode === 'specific') {
                // Generar cartas espec√≠ficas - sin repetici√≥n
                const gameMode = document.querySelector('input[name="game-mode"]:checked').value;
                
                if (gameMode === 'symbols') {
                    // Modo s√≠mbolos - usar pokerCards
                    const shuffled = shuffleArray(pokerCards);
                    cardSequence = shuffled.slice(0, selectedCards);
                } else {
                    // Modo cartas - usar realCards
                    const shuffled = shuffleArray(realCards);
                    cardSequence = shuffled.slice(0, selectedCards);
                }
            } else {
                // Generar barajas completas - cada baraja mezclada independientemente
                const gameMode = document.querySelector('input[name="game-mode"]:checked').value;
                
                if (gameMode === 'symbols') {
                    // Crear barajas mezcladas independientemente
                    for (let i = 0; i < selectedDecks; i++) {
                        const shuffledDeck = shuffleArray(pokerCards);
                        cardSequence = cardSequence.concat(shuffledDeck);
                    }
                } else {
                    // Crear barajas mezcladas independientemente
                    for (let i = 0; i < selectedDecks; i++) {
                        const shuffledDeck = shuffleArray(realCards);
                        cardSequence = cardSequence.concat(shuffledDeck);
                    }
                }
            }
            
            // Verificar que no hay repeticiones en el modo espec√≠fico
            if (cardsMode === 'specific') {
                const uniqueCards = new Set(cardSequence);
                if (uniqueCards.size !== cardSequence.length) {
                    console.error('ERROR: Se detectaron cartas repetidas en modo espec√≠fico');
                    console.log('Cartas repetidas:', cardSequence.filter((item, index) => cardSequence.indexOf(item) !== index));
                } else {
                    console.log(`‚úÖ Modo espec√≠fico: ${uniqueCards.size} cartas √∫nicas sin repeticiones`);
                }
            }
            
            // Verificar que cada baraja completa tiene exactamente 52 cartas √∫nicas
            if (cardsMode === 'decks') {
                let allDecksValid = true;
                for (let i = 0; i < selectedDecks; i++) {
                    const startIndex = i * 52;
                    const endIndex = startIndex + 52;
                    const deckCards = cardSequence.slice(startIndex, endIndex);
                    const uniqueDeckCards = new Set(deckCards);
                    
                    if (uniqueDeckCards.size !== 52) {
                        console.error(`‚ùå ERROR: Baraja ${i + 1} no tiene 52 cartas √∫nicas`);
                        console.log(`Baraja ${i + 1}:`, deckCards);
                        allDecksValid = false;
                    } else {
                        console.log(`‚úÖ Baraja ${i + 1}: ${uniqueDeckCards.size} cartas √∫nicas`);
                    }
                }
                
                if (allDecksValid) {
                    console.log(`‚úÖ Todas las ${selectedDecks} baraja(s) verificadas correctamente`);
                }
            }
            
            console.log('üé¥ Secuencia generada:', cardSequence);
            console.log('üìä Total de cartas:', cardSequence.length);
            console.log('üîç Cartas √∫nicas totales:', new Set(cardSequence).size);
            
            // Mostrar informaci√≥n de distribuci√≥n
            if (cardsMode === 'decks') {
                console.log(`üì¶ Distribuci√≥n: ${selectedDecks} baraja(s) de 52 cartas cada una`);
                for (let i = 0; i < selectedDecks; i++) {
                    const startIndex = i * 52;
                    const endIndex = startIndex + 52;
                    const deckCards = cardSequence.slice(startIndex, endIndex);
                    console.log(`   Baraja ${i + 1}: ${deckCards.length} cartas`);
                }
            }
        }

        // Funci√≥n para mostrar cartas en la fase de memorizaci√≥n
        function displayCards() {
            const cardDisplay = document.getElementById('card-display');
            const gameMode = document.querySelector('input[name="game-mode"]:checked').value;
            
            cardDisplay.innerHTML = '';
            
            // Aplicar clase para modo cartas si es necesario
            if (gameMode === 'cards') {
                cardDisplay.classList.add('cards-mode');
            } else {
                cardDisplay.classList.remove('cards-mode');
            }
            
            // Calcular qu√© cartas mostrar seg√∫n el modo de visualizaci√≥n
            const startIndex = currentCardIndex;
            const cardsPerPage = displayMode === 'pairs' ? 2 : 1;
            const endIndex = Math.min(startIndex + cardsPerPage, cardSequence.length);
            const cardsToShow = cardSequence.slice(startIndex, endIndex);
            
            cardsToShow.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'poker-card';
                
                // Usar tama√±os centralizados solo si no es modo cartas
                if (gameMode !== 'cards') {
                    const cardSizes = getCardSizes('main');
                    cardElement.style.cssText = `width: ${cardSizes.width}; height: ${cardSizes.height}; margin: 2px; display: inline-block; flex-shrink: 0; box-sizing: border-box;`;
                } else {
                    // En modo cartas, no aplicar estilos inline para que los estilos CSS tengan prioridad
                    cardElement.style.cssText = `margin: 0; display: inline-block; flex-shrink: 0; box-sizing: border-box;`;
                }
                
                if (gameMode === 'symbols') {
                    // Modo s√≠mbolos - mostrar s√≠mbolos Unicode
                    const number = card.replace(/[‚ô†‚ô•‚ô¶‚ô£]/g, '');
                    const suit = card.replace(/[A-Z0-9]/g, '');
                    const suitColor = (suit === '‚ô•' || suit === '‚ô¶') ? '#dc3545' : '#333';
                    
                    cardElement.innerHTML = `
                        <div style="
                            width: 100%; 
                            height: 100%; 
                            background: white;
                            border-radius: 12px;
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            justify-content: center;
                            color: ${suitColor};
                            font-size: ${cardSizes.fontSize};
                            font-weight: bold;
                        ">
                            <div style="font-size: ${cardSizes.numberFontSize}; margin-bottom: ${cardSizes.marginBottom};">${number}</div>
                            <div style="font-size: ${cardSizes.fontSize};">${suit}</div>
                        </div>
                    `;
                } else {
                    // Modo cartas - mostrar im√°genes reales
                    const { suit, value } = parseRealCard(card);
                    
                    // Mapear palos a s√≠mbolos para determinar color
                    let suitSymbol = '';
                    let suitColor = '#333';
                    switch(suit) {
                        case 'spades': suitSymbol = '‚ô†'; suitColor = '#333'; break;
                        case 'hearts': suitSymbol = '‚ô•'; suitColor = '#dc3545'; break;
                        case 'diamonds': suitSymbol = '‚ô¶'; suitColor = '#dc3545'; break;
                        case 'clubs': suitSymbol = '‚ô£'; suitColor = '#333'; break;
                    }
                    
                                    cardElement.innerHTML = generateCardPattern(value, suitSymbol, suitColor);
            }
            
            cardDisplay.appendChild(cardElement);
        });
        
        // Forzar comportamiento horizontal en m√≥viles
        if (window.innerWidth <= 768) {
            const gap = window.innerWidth <= 480 ? '6px' : '8px';
            const minHeight = window.innerWidth <= 480 ? '240px' : '320px';
            const padding = window.innerWidth <= 480 ? '3px' : '5px';
            
            cardDisplay.style.cssText = `
                display: flex !important;
                flex-direction: row !important;
                flex-wrap: nowrap !important;
                justify-content: center !important;
                align-items: center !important;
                gap: ${gap} !important;
                overflow-x: auto !important;
                min-height: ${minHeight} !important;
                padding: 0 ${padding} !important;
                max-width: 100vw !important;
            `;
        }
            
            // Actualizar indicador de progreso
            document.getElementById('progress').textContent = `Cartas ${startIndex + 1}-${endIndex} de ${cardSequence.length}`;
            
            // Actualizar botones de navegaci√≥n
            document.getElementById('prev-btn').disabled = startIndex === 0;
            
            // En la √∫ltima p√°gina, el bot√≥n siguiente debe estar disponible para terminar memorizaci√≥n
            const isLastPage = endIndex >= cardSequence.length;
            const nextBtn = document.getElementById('next-btn');
            nextBtn.disabled = false; // Siempre habilitado
            
            // Cambiar el texto del bot√≥n en la √∫ltima p√°gina
            if (isLastPage) {
                nextBtn.textContent = 'Terminar Memorizaci√≥n ‚Üí';
                nextBtn.onclick = finishMemorization;
            } else {
                nextBtn.textContent = 'Siguiente ‚Üí';
                nextBtn.onclick = nextCards;
            }
            
            // Mostrar indicador de mazo solo en la primera p√°gina de cada mazo
            const deckIndicator = document.getElementById('deck-indicator');
            const currentDeckIndicator = document.getElementById('current-deck-indicator');
            
            if (cardsMode === 'decks' && selectedDecks > 1) {
                // Calcular qu√© mazo estamos mostrando
                const currentDeck = Math.floor(startIndex / 52) + 1;
                const isFirstPageOfDeck = (startIndex % 52) === 0;
                
                if (isFirstPageOfDeck && currentDeck <= selectedDecks) {
                    currentDeckIndicator.textContent = currentDeck;
                    deckIndicator.style.display = 'flex';
                } else {
                    deckIndicator.style.display = 'none';
                }
            } else {
                // Ocultar el indicador en las dem√°s p√°ginas del mazo
                deckIndicator.style.display = 'none';
            }
        }

        // Funci√≥n para navegar a la p√°gina anterior
        function previousCards() {
            const cardsPerPage = displayMode === 'pairs' ? 2 : 1;
            if (currentCardIndex > 0) {
                currentCardIndex = Math.max(0, currentCardIndex - cardsPerPage);
                displayCards();
            }
        }

        // Funci√≥n para navegar a la p√°gina siguiente
        function nextCards() {
            const cardsPerPage = displayMode === 'pairs' ? 2 : 1;
            if (currentCardIndex + cardsPerPage < cardSequence.length) {
                currentCardIndex = Math.min(cardSequence.length - cardsPerPage, currentCardIndex + cardsPerPage);
                displayCards();
            } else {
                // Si estamos en la √∫ltima p√°gina, terminar memorizaci√≥n
                finishMemorization();
            }
        }

        // Funci√≥n para manejar teclas de navegaci√≥n
        document.addEventListener('keydown', function(event) {
            if (gameState === 'memorization') {
                if (event.key === 'ArrowLeft') {
                    event.preventDefault();
                    previousCards();
                } else if (event.key === 'ArrowRight') {
                    event.preventDefault();
                    nextCards();
                }
            }
        });

        // Funci√≥n para actualizar informaci√≥n de cartas
        function updateCardsInfo() {
            const specificMode = document.getElementById('specific-cards-mode').checked;
            const cardsInput = document.getElementById('cards-input');
            const decksInput = document.getElementById('decks-input');
            const selectedInfo = document.getElementById('selected-info');
            const deckInfo = document.getElementById('deck-info');
            const cardsModeInfo = document.getElementById('cards-mode-info');
            
            if (specificMode) {
                cardsMode = 'specific';
                selectedCards = parseInt(cardsInput.value) || 5;
                const displayText = displayMode === 'pairs' ? '2 cartas por p√°gina' : '1 carta por p√°gina';
                selectedInfo.textContent = `Memorizar√°s ${selectedCards} cartas espec√≠ficas (${displayText})`;
                deckInfo.textContent = 'Total disponible: 52 cartas √∫nicas';
            } else {
                cardsMode = 'decks';
                selectedDecks = parseInt(decksInput.value) || 1;
                selectedCards = selectedDecks * 52;
                const displayText = displayMode === 'pairs' ? '2 cartas por p√°gina' : '1 carta por p√°gina';
                selectedInfo.textContent = `Memorizar√°s ${selectedDecks} baraja(s) completa(s) (${selectedCards} cartas total) (${displayText})`;
                deckInfo.textContent = `Total: ${selectedCards} cartas (${selectedDecks} baraja${selectedDecks > 1 ? 's' : ''})`;
            }
            
            // Mostrar/ocultar mensaje informativo del modo cartas
            const gameMode = document.querySelector('input[name="game-mode"]:checked').value;
            if (gameMode === 'cards') {
                cardsModeInfo.style.display = 'block';
            } else {
                cardsModeInfo.style.display = 'none';
            }
        }

        // Funci√≥n para actualizar informaci√≥n de rondas
        function updateRoundsInfo() {
            const roundsInput = document.getElementById('rounds-input');
            const roundsInfo = document.getElementById('rounds-info');
            const roundsConfigInfo = document.getElementById('rounds-config-info');
            
            totalRounds = parseInt(roundsInput.value) || 10;
            roundsInfo.textContent = `Jugar√°s ${totalRounds} rondas en total`;
            
            // Actualizar mensaje informativo seg√∫n el n√∫mero de rondas
            if (totalRounds > 1) {
                roundsConfigInfo.style.display = 'block';
                roundsConfigInfo.innerHTML = `üí° La configuraci√≥n de tiempo se mantendr√° predeterminada igual que la inicial en todas las ${totalRounds} rondas, pero podr√°s modificarla entre rondas si lo deseas. Si seleccionas autoavance, se mantendr√° marcado autom√°ticamente.`;
            } else {
                roundsConfigInfo.style.display = 'none';
            }
        }

        // Funci√≥n para actualizar informaci√≥n de visualizaci√≥n
        function updateDisplayInfo() {
            const pairsMode = document.getElementById('pairs-mode').checked;
            const displayInfo = document.getElementById('display-info');
            
            if (pairsMode) {
                displayMode = 'pairs';
                displayInfo.textContent = 'Ver√°s las cartas en parejas de 2 por p√°gina.';
            } else {
                displayMode = 'single';
                displayInfo.textContent = 'Ver√°s las cartas de forma individual, 1 por p√°gina.';
            }
        }

        // Funci√≥n para actualizar resumen de configuraci√≥n
        function updateSummary() {
            const summaryCards = document.getElementById('summary-cards');
            const summaryRounds = document.getElementById('summary-rounds');
            const summaryTimers = document.getElementById('summary-timers');
            const summaryMode = document.getElementById('summary-mode');
            const summaryRandomization = document.getElementById('summary-randomization');
            
            // Actualizar informaci√≥n de cartas
            if (cardsMode === 'specific') {
                summaryCards.textContent = `Cartas: ${selectedCards}`;
            } else {
                summaryCards.textContent = `Cartas: ${selectedDecks} baraja(s) (${selectedCards} cartas)`;
            }
            
            // Actualizar informaci√≥n de rondas
            summaryRounds.textContent = `Rondas: ${totalRounds}`;
            
            // Actualizar informaci√≥n de temporizadores
            const memorizationMode = document.getElementById('memorization-mode').checked;
            const memorizationTime = parseFloat(document.getElementById('memorization-timer').value) || 15;
            const recallTime = parseFloat(document.getElementById('recall-timer').value) || 30;
            
            summaryTimers.textContent = `Temporizadores: Memorizaci√≥n ${memorizationTime}s, Recall ${recallTime}s`;
            
            // Actualizar informaci√≥n de modo
            if (memorizationMode) {
                summaryMode.textContent = 'Modo: Tiempo de memorizaci√≥n';
            } else {
                const autoAdvanceTime = parseFloat(document.getElementById('auto-advance-time').value) || 3;
                summaryMode.textContent = `Modo: Autoavance (${autoAdvanceTime}s por p√°gina)`;
            }
            
            // Actualizar informaci√≥n de aleatorizaci√≥n
            const gameMode = document.querySelector('input[name="game-mode"]:checked').value;
            const modeText = gameMode === 'symbols' ? 's√≠mbolos' : 'im√°genes reales';
            
            if (cardsMode === 'specific') {
                summaryRandomization.textContent = `üé≤ Cada ronda tendr√° ${selectedCards} cartas diferentes en modo ${modeText} (sin repeticiones)`;
            } else {
                summaryRandomization.textContent = `üé≤ Cada ronda tendr√° ${selectedDecks} baraja(s) mezclada(s) independientemente en modo ${modeText}`;
            }
        }

                 // Funci√≥n para actualizar descripci√≥n del modo
         function updateModeDescription() {
             const description = document.getElementById('mode-description');
             const memorizationMode = document.getElementById('memorization-mode').checked;
             const memorizationTime = parseFloat(document.getElementById('memorization-timer').value) || 0;
             const autoAdvanceTime = parseFloat(document.getElementById('auto-advance-time').value) || 0;
             
             if (memorizationMode) {
                 if (memorizationTime > 0) {
                     description.textContent = `El juego usar√° el tiempo de memorizaci√≥n configurado (${memorizationTime.toFixed(1)} segundos).`;
                 } else {
                     description.textContent = `El juego usar√° el tiempo de memorizaci√≥n configurado (escribe un tiempo).`;
                 }
             } else {
                 const pages = Math.ceil(selectedCards / 2);
                 if (autoAdvanceTime > 0) {
                     const totalTime = pages * autoAdvanceTime;
                     description.textContent = `El juego avanzar√° autom√°ticamente cada ${autoAdvanceTime.toFixed(1)} segundos por p√°gina (${totalTime.toFixed(1)} segundos total).`;
                 } else {
                     description.textContent = `El juego avanzar√° autom√°ticamente cada (escribe tiempo) segundos por p√°gina.`;
                 }
             }
         }

        // Funci√≥n para iniciar el juego
        function startGame() {
            // Actualizar configuraci√≥n con valores actuales
            updateCardsInfo();
            updateDisplayInfo();
            updateRoundsInfo();
            
            // Validar configuraci√≥n
            if (!validateConfiguration()) {
                return;
            }
            
            // Generar secuencia de cartas
            generateCardSequence();
            
            // Configurar variables de juego
            currentCardIndex = 0;
            gameState = 'memorization';
            
            // Configurar timer seg√∫n el modo
            const memorizationMode = document.getElementById('memorization-mode').checked;
            if (memorizationMode) {
                currentMode = 'memorization';
                memorizationTime = parseFloat(document.getElementById('memorization-timer').value) || 15;
                timer = memorizationTime;
            } else {
                currentMode = 'auto-advance';
                autoAdvanceTime = parseFloat(document.getElementById('auto-advance-time').value) || 3;
                timer = autoAdvanceTime;
            }
            
            // Mostrar fase de preparaci√≥n antes de iniciar memorizaci√≥n
            document.getElementById('setup-phase').classList.add('hidden');
            const prepEl = document.getElementById('preparation-phase');
            const prepCountdownEl = document.getElementById('prep-countdown');
            if (prepEl && prepCountdownEl) {
                prepEl.classList.remove('hidden');
                let prepTime = 5;
                prepCountdownEl.textContent = `${prepTime}`;
                if (window.prepInterval) clearInterval(window.prepInterval);
                window.prepInterval = setInterval(() => {
                    prepTime--;
                    prepCountdownEl.textContent = `${prepTime}`;
                    if (prepTime <= 0) {
                        clearInterval(window.prepInterval);
                        prepEl.classList.add('hidden');

                        document.getElementById('memorization-phase').classList.remove('hidden');
                        displayCards();
                        memorizationStartTime = Date.now();
                        
                        // Actualizar informaci√≥n y comenzar timer
                        document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
                        const memorizationInfo = document.getElementById('memorization-info');
                        const randomInfo = cardsMode === 'decks' ? 
                            `(${selectedDecks} baraja${selectedDecks > 1 ? 's' : ''} mezclada${selectedDecks > 1 ? 's' : ''} aleatoriamente)` : 
                            '(cartas seleccionadas aleatoriamente)';
                        if (currentMode === 'auto-advance') {
                            const cardsPerPage = displayMode === 'pairs' ? 2 : 1;
                            const totalPages = Math.ceil(cardSequence.length / cardsPerPage);
                            memorizationInfo.textContent = `Ronda ${currentRound} - P√°gina 1 de ${totalPages}. Avanzar√° autom√°ticamente en ${autoAdvanceTime.toFixed(1)} segundos. Usa ‚Üê ‚Üí para navegar. ${randomInfo}`;
                        } else {
                            memorizationInfo.textContent = `Ronda ${currentRound} - Memoriza estas cartas. Tienes ${memorizationTime.toFixed(1)} segundos. Usa ‚Üê ‚Üí para navegar. ${randomInfo}`;
                        }
                        startTimer();
                    }
                }, 1000);
            } else {
                // Fallback directo
                document.getElementById('memorization-phase').classList.remove('hidden');
                displayCards();
                memorizationStartTime = Date.now();
                document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
                startTimer();
            }
            
            // Mostrar informaci√≥n de aleatorizaci√≥n
            const gameMode = document.querySelector('input[name="game-mode"]:checked').value;
            const modeText = gameMode === 'symbols' ? 's√≠mbolos' : 'im√°genes reales';
            console.log(`üéØ Ronda ${currentRound}: ${cardSequence.length} cartas en modo ${modeText}`);
            if (cardsMode === 'decks') {
                console.log(`üì¶ Distribuci√≥n: ${selectedDecks} baraja(s) mezclada(s) independientemente`);
            }
            
            // Actualizar informaci√≥n
            document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
            const memorizationInfo = document.getElementById('memorization-info');
            
            // Agregar informaci√≥n sobre aleatorizaci√≥n
            const randomInfo = cardsMode === 'decks' ? 
                `(${selectedDecks} baraja${selectedDecks > 1 ? 's' : ''} mezclada${selectedDecks > 1 ? 's' : ''} aleatoriamente)` : 
                '(cartas seleccionadas aleatoriamente)';
            
            if (currentMode === 'auto-advance') {
                const cardsPerPage = displayMode === 'pairs' ? 2 : 1;
                const totalPages = Math.ceil(cardSequence.length / cardsPerPage);
                memorizationInfo.textContent = `Ronda ${currentRound} - P√°gina 1 de ${totalPages}. Avanzar√° autom√°ticamente en ${autoAdvanceTime.toFixed(1)} segundos. Usa ‚Üê ‚Üí para navegar. ${randomInfo}`;
            } else {
                memorizationInfo.textContent = `Ronda ${currentRound} - Memoriza estas cartas. Tienes ${memorizationTime.toFixed(1)} segundos. Usa ‚Üê ‚Üí para navegar. ${randomInfo}`;
            }
            
            // Iniciar timer
            startTimer();
        }

        // Funci√≥n para validar configuraci√≥n
        function validateConfiguration() {
            const specificMode = document.getElementById('specific-cards-mode').checked;
            const cardsInput = document.getElementById('cards-input');
            const decksInput = document.getElementById('decks-input');
            const roundsInput = document.getElementById('rounds-input');
            const memorizationTimer = document.getElementById('memorization-timer');
            const recallTimer = document.getElementById('recall-timer');
            const autoAdvanceTime = document.getElementById('auto-advance-time');
            
            // Validar n√∫mero de cartas
            if (specificMode) {
                const cards = parseInt(cardsInput.value);
                if (!cards || cards < 1 || cards > 52) {
                    alert('Por favor, ingresa un n√∫mero v√°lido de cartas (1-52).');
                    return false;
                }
            } else {
                const decks = parseInt(decksInput.value);
                if (!decks || decks < 1 || decks > 10) {
                    alert('Por favor, ingresa un n√∫mero v√°lido de barajas (1-10).');
                    return false;
                }
            }
            
            // Validar n√∫mero de rondas
            const rounds = parseInt(roundsInput.value);
            if (!rounds || rounds < 1 || rounds > 100) {
                alert('Por favor, ingresa un n√∫mero v√°lido de rondas (1-100).');
                return false;
            }
            
            // Validar temporizadores
            const memorizationMode = document.getElementById('memorization-mode').checked;
            if (memorizationMode) {
                const memorizationTime = parseFloat(memorizationTimer.value);
                if (!memorizationTime || memorizationTime <= 0) {
                    alert('Por favor, ingresa un tiempo v√°lido para memorizaci√≥n.');
                    return false;
                }
            } else {
                const autoAdvance = parseFloat(autoAdvanceTime.value);
                if (!autoAdvance || autoAdvance <= 0) {
                    alert('Por favor, ingresa un tiempo v√°lido para autoavance.');
                    return false;
                }
            }
            
            const recallTime = parseFloat(recallTimer.value);
            if (!recallTime || recallTime <= 0) {
                alert('Por favor, ingresa un tiempo v√°lido para recall.');
                return false;
            }
            
            return true;
        }

        // Funci√≥n para iniciar timer
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            const startTime = Date.now();
            
            timerInterval = setInterval(() => {
                timer -= 0.1;
                const elapsedTime = ((Date.now() - startTime) / 1000).toFixed(1);
                
                if (timer <= 0) {
                    clearInterval(timerInterval);
                    if (currentMode === 'auto-advance') {
                        // Autoavance - pasar a siguiente p√°gina
                        const cardsPerPage = displayMode === 'pairs' ? 2 : 1;
                        if (currentCardIndex + cardsPerPage < cardSequence.length) {
                            nextCards();
                            timer = autoAdvanceTime;
                            startTimer();
                        } else {
                            // √öltima p√°gina - terminar memorizaci√≥n
                            finishMemorization();
                        }
                    } else {
                        // Tiempo de memorizaci√≥n agotado
                        finishMemorization();
                    }
                } else {
                    document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
                    document.getElementById('elapsed-time').textContent = `Tiempo empleado: ${elapsedTime} segundos`;
                }
            }, 100);
        }

        // Funci√≥n para terminar memorizaci√≥n
        function finishMemorization() {
            if (timerInterval) clearInterval(timerInterval);
            
            // Calcular tiempo real de memorizaci√≥n
            actualMemorizationTime = (Date.now() - memorizationStartTime) / 1000;
            
            // Cambiar a fase de escritura
            gameState = 'input';
            document.getElementById('memorization-phase').classList.add('hidden');
            document.getElementById('input-phase').classList.remove('hidden');
            
            // Configurar inputs para escritura
            setupCardInputs();
            
            // Iniciar timer de recall
            recallTime = parseFloat(document.getElementById('recall-timer').value) || 30;
            timer = recallTime;
            startRecallTimer();
        }

        // Funci√≥n para detectar si estamos en m√≥vil
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                   window.innerWidth <= 768;
        }
        
        // Funci√≥n centralizada para obtener tama√±os de cartas consistentes
        function getCardSizes(context = 'main') {
            const isMobile = window.innerWidth <= 768;
            const isSmallMobile = window.innerWidth <= 480;
            
            switch(context) {
                case 'main':
                    // Tama√±o principal para memorizaci√≥n
                    return {
                        width: '200px',
                        height: '280px',
                        fontSize: isMobile ? '2.5rem' : '4rem',
                        numberFontSize: isMobile ? '2rem' : '3rem',
                        marginBottom: isMobile ? '5px' : '10px'
                    };
                case 'mobile':
                    // Tama√±o para m√≥viles en memorizaci√≥n
                    return {
                        width: isSmallMobile ? '160px' : '220px',
                        height: isSmallMobile ? '224px' : '308px',
                        fontSize: isSmallMobile ? '2.2rem' : '3rem',
                        numberFontSize: isSmallMobile ? '1.8rem' : '2.4rem',
                        marginBottom: isSmallMobile ? '4px' : '6px'
                    };
                case 'table':
                    // Tama√±o para tabla de resultados
                    return {
                        width: isSmallMobile ? '45px' : isMobile ? '50px' : '60px',
                        height: isSmallMobile ? '63px' : isMobile ? '70px' : '80px',
                        fontSize: isSmallMobile ? '0.7rem' : isMobile ? '0.8rem' : '1.5rem',
                        numberFontSize: isSmallMobile ? '0.6rem' : isMobile ? '0.7rem' : '1.2rem',
                        marginBottom: isSmallMobile ? '1px' : isMobile ? '2px' : '5px'
                    };
                default:
                    return getCardSizes('main');
            }
        }
        
        // Funci√≥n para configurar inputs de cartas
        function setupCardInputs() {
            const container = document.getElementById('cards-input-container');
            container.innerHTML = '';
            
            // Crear inputs para cada carta
            for (let i = 0; i < cardSequence.length; i++) {
                // Agregar t√≠tulo del mazo cada 52 cartas (baraja completa)
                if (i % 52 === 0) {
                    const mazoTitle = document.createElement('div');
                    mazoTitle.style.cssText = 'font-weight: bold; font-size: 1.3rem; color: #333; margin: 20px 0 15px 0; text-align: left; width: 100%; grid-column: 1 / -1;';
                    mazoTitle.textContent = `Mazo ${Math.floor(i / 52) + 1}:`;
                    container.appendChild(mazoTitle);
                }
                
                const cardRow = document.createElement('div');
                cardRow.className = 'card-input-row';
                
                // Input para n√∫mero/valor de la carta
                const numberInput = document.createElement('input');
                numberInput.type = 'text';
                numberInput.className = 'card-number-select';
                numberInput.placeholder = 'As, Rey, 10...';
                numberInput.dataset.cardIndex = i;
                numberInput.dataset.inputType = 'number';
                
                // Select para palo
                const suitSelect = document.createElement('select');
                suitSelect.className = 'suit-select';
                suitSelect.dataset.cardIndex = i;
                suitSelect.dataset.inputType = 'suit';
                
                // Opciones de palos (solo iconos con colores)
                const suits = [
                    { value: '', text: 'Palo', color: '#666' },
                    { value: 'P', text: '‚ô†', color: '#333' },
                    { value: 'C', text: '‚ô•', color: '#dc3545' },
                    { value: 'D', text: '‚ô¶', color: '#dc3545' },
                    { value: 'T', text: '‚ô£', color: '#333' }
                ];
                
                suits.forEach(suit => {
                    const option = document.createElement('option');
                    option.value = suit.value;
                    option.textContent = suit.text;
                    option.style.color = suit.color;
                    option.style.backgroundColor = 'white';
                    option.style.fontSize = '16px';
                    option.style.padding = '8px';
                    option.style.fontWeight = 'bold';
                    suitSelect.appendChild(option);
                });
                
                // Agregar evento para cambiar el color del texto seleccionado
                suitSelect.addEventListener('change', function() {
                    const selectedValue = this.value;
                    const selectedOption = suits.find(suit => suit.value === selectedValue);
                    if (selectedOption && selectedOption.color) {
                        this.style.color = selectedOption.color;
                    } else {
                        this.style.color = '#666';
                    }
                });
                
                // Evento para actualizar el color cuando se selecciona un palo
                suitSelect.addEventListener('change', function() {
                    const selectedValue = this.value;
                    const selectedOption = suits.find(suit => suit.value === selectedValue);
                    if (selectedOption && selectedOption.color) {
                        this.style.color = selectedOption.color;
                        this.setAttribute('data-selected', selectedValue);
                    } else {
                        this.style.color = '#666';
                        this.removeAttribute('data-selected');
                    }
                });
                
                cardRow.appendChild(numberInput);
                cardRow.appendChild(suitSelect);
                container.appendChild(cardRow);
            }
            
            // Enfocar el primer input
            const firstInput = container.querySelector('.card-number-select');
            if (firstInput) {
                firstInput.focus();
            }
        }

        // Funci√≥n para iniciar timer de recall
        function startRecallTimer() {
            if (recallTimerInterval) clearInterval(recallTimerInterval);
            
            recallTimerInterval = setInterval(() => {
                timer -= 0.1;
                
                if (timer <= 0) {
                    clearInterval(recallTimerInterval);
                    verifyCardAnswers();
                } else {
                    document.getElementById('recall-timer-display').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
                }
            }, 100);
        }

        // Funci√≥n para verificar respuestas de cartas
        function verifyCardAnswers() {
            if (recallTimerInterval) clearInterval(recallTimerInterval);
            
            // Inicializar array para guardar respuestas del usuario
            window.userCardResponses = [];
            
            let correctCards = 0;
            const totalCards = cardSequence.length;
            
            console.log('=== VERIFICANDO RESPUESTAS ===');
            console.log('Secuencia original:', cardSequence);
            
            // Verificar cada carta
            for (let i = 0; i < totalCards; i++) {
                const numberInput = document.querySelector(`input[data-card-index="${i}"][data-input-type="number"]`);
                const suitSelect = document.querySelector(`select[data-card-index="${i}"][data-input-type="suit"]`);
                
                if (!numberInput || !suitSelect) {
                    console.log(`‚ùå No se encontraron inputs para carta ${i + 1}`);
                    continue;
                }
                
                const userNumber = numberInput.value.trim();
                const userSuit = suitSelect.value;
                const originalCard = cardSequence[i];
                
                console.log(`Carta ${i + 1}: Original="${originalCard}", Usuario="${userNumber}${userSuit}"`);
                
                // Guardar respuesta del usuario
                window.userCardResponses.push({
                    cardIndex: i,
                    number: userNumber,
                    suit: userSuit
                });
                
                // Obtener valores esperados
                const expectedValues = getExpectedUserValueFromImage(originalCard);
                const normalizedUserNumber = normalizeUserValue(userNumber);
                const isNumberCorrect = normalizedUserNumber === expectedValues.number.toLowerCase();
                const isSuitCorrect = userSuit === expectedValues.suit;
                const isCardCorrect = isNumberCorrect && isSuitCorrect;
                
                console.log(`  Esperado: ${expectedValues.number}${expectedValues.suit}, Usuario: ${userNumber}${userSuit}, Correcto: ${isCardCorrect}`);
                
                // Aplicar estilos visuales
                if (isCardCorrect) {
                    correctCards++;
                    numberInput.classList.add('correct');
                    suitSelect.classList.add('correct');
                } else {
                    numberInput.classList.add('incorrect');
                    suitSelect.classList.add('incorrect');
                }
            }
            
            // Calcular porcentaje de acierto
            const accuracy = Math.round((correctCards / totalCards) * 100);
            
            // Actualizar puntuaci√≥n de la ronda
            const roundScore = accuracy === 100 ? 1 : 0;
            roundScores.push(roundScore);
            totalScore += roundScore;
            
            // Guardar estad√≠sticas de la ronda
            if (!window.roundAccuracies) window.roundAccuracies = [];
            if (!window.roundMemTimes) window.roundMemTimes = [];
            
            window.roundAccuracies.push(accuracy);
            window.roundMemTimes.push(actualMemorizationTime);
            
            console.log(`Resultado: ${correctCards}/${totalCards} cartas correctas (${accuracy}%)`);
            console.log('Respuestas guardadas:', window.userCardResponses);
            
            // Mostrar resultado
            showRoundResult(accuracy, correctCards, totalCards);
        }

        // Funci√≥n para mostrar resultado de la ronda
        function showRoundResult(accuracy, correctCards, totalCards) {
            gameState = 'result';
            document.getElementById('input-phase').classList.add('hidden');
            document.getElementById('result-phase').classList.remove('hidden');
            
            // Actualizar informaci√≥n de la ronda
            document.getElementById('current-round-display').textContent = currentRound;
            document.getElementById('current-round-number').textContent = currentRound;
            document.getElementById('round-number').textContent = currentRound;
            document.getElementById('total-rounds').textContent = totalRounds;
            
            // Actualizar progreso de la ronda
            const progressFill = document.getElementById('round-progress-fill');
            const progressPercentage = (currentRound / totalRounds) * 100;
            progressFill.style.width = progressPercentage + '%';
            
            // Mostrar mensaje de resultado
            const resultMessage = document.getElementById('result-message');
            if (accuracy === 100) {
                resultMessage.innerHTML = `¬°Perfecto! Todas las cartas correctas (${correctCards}/${totalCards})<br><span style='font-size:1.1rem;color:#1976d2;'>Tiempo de memorizaci√≥n: <b>${actualMemorizationTime.toFixed(1)}</b> segundos</span>`;
                resultMessage.className = 'result-message correct-result';
            } else {
                resultMessage.innerHTML = `Respuesta parcialmente correcta: ${correctCards}/${totalCards} cartas (${accuracy}%)<br><span style='font-size:1.1rem;color:#1976d2;'>Tiempo de memorizaci√≥n: <b>${actualMemorizationTime.toFixed(1)}</b> segundos</span>`;
                resultMessage.className = 'result-message incorrect-result';
            }
            
            // Actualizar estad√≠sticas de la ronda
            document.getElementById('round-accuracy').textContent = accuracy + '%';
            document.getElementById('round-status').textContent = accuracy === 100 ? 'Correcto' : 'Incorrecto';
            
            // Actualizar clases de color
            const accuracyElement = document.getElementById('round-accuracy');
            const statusElement = document.getElementById('round-status');
            
            accuracyElement.className = `stat-number ${accuracy === 100 ? 'correct' : 'incorrect'}`;
            statusElement.className = `stat-number ${accuracy === 100 ? 'correct' : 'incorrect'}`;
            
            // Actualizar progresi√≥n de rondas
            updateRoundResult(accuracy);
            
            // Actualizar estad√≠sticas totales
            updateProgressDisplay();
            
            // Mostrar resultados detallados si es modo cartas
            const gameMode = document.querySelector('input[name="game-mode"]:checked').value;
            if (gameMode === 'cards') {
                showDetailedCardResults();
            }
            
            // Configurar botones seg√∫n si es la √∫ltima ronda
            if (currentRound >= totalRounds) {
                document.getElementById('next-round-btn').textContent = 'Ver Resultados Finales';
                document.getElementById('next-round-btn').onclick = showFinalResults;
            }
            
                                     // Inicializar configuraci√≥n de tiempo para siguiente ronda
            initializeResultTimeConfig();
            
            // Configurar event listeners para la configuraci√≥n de resultados
            setupResultConfiguration();
         }

        // Funci√≥n para mostrar cartas de nuevo
        function showCardsAgain() {
            document.getElementById('input-phase').classList.add('hidden');
            document.getElementById('memorization-phase').classList.remove('hidden');
            
            // Reiniciar a la primera p√°gina
            currentCardIndex = 0;
            displayCards();
            
            // Configurar timer de nuevo
            if (currentMode === 'auto-advance') {
                timer = autoAdvanceTime;
            } else {
                timer = memorizationTime;
            }
            
            // Reiniciar tiempo de memorizaci√≥n
            memorizationStartTime = Date.now();
            
            // Actualizar informaci√≥n
            document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
            const memorizationInfo = document.getElementById('memorization-info');
            if (currentMode === 'auto-advance') {
                const totalPages = Math.ceil(cardSequence.length / 2);
                memorizationInfo.textContent = `Ronda ${currentRound} - P√°gina 1 de ${totalPages}. Avanzar√° autom√°ticamente en ${autoAdvanceTime.toFixed(1)} segundos. Usa ‚Üê ‚Üí para navegar.`;
            } else {
                memorizationInfo.textContent = `Ronda ${currentRound} - Memoriza estas cartas. Tienes ${memorizationTime.toFixed(1)} segundos. Usa ‚Üê ‚Üí para navegar.`;
            }
            
            startTimer();
        }

        // Funci√≥n completamente nueva para mostrar resultados
        function showDetailedCardResults() {
            const resultContainer = document.getElementById('result-phase');
            
            // Buscar o crear contenedor para resultados detallados
            let detailedResultsContainer = document.getElementById('detailed-card-results');
            if (!detailedResultsContainer) {
                detailedResultsContainer = document.createElement('div');
                detailedResultsContainer.id = 'detailed-card-results';
                detailedResultsContainer.style.cssText = 'margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 10px; border: 2px solid #e9ecef;';
                
                // Insertar despu√©s de las estad√≠sticas de la ronda
                const roundStatsGrid = document.getElementById('round-stats-grid');
                if (roundStatsGrid && roundStatsGrid.parentNode) {
                    roundStatsGrid.parentNode.insertBefore(detailedResultsContainer, roundStatsGrid.nextSibling);
                } else {
                    resultContainer.appendChild(detailedResultsContainer);
                }
            }
            
            // Limpiar contenido anterior
            detailedResultsContainer.innerHTML = '';
            
            // Crear t√≠tulo con bot√≥n de ocultar/mostrar
            const titleContainer = document.createElement('div');
            titleContainer.style.cssText = 'display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;';
            
            const title = document.createElement('h3');
            title.textContent = 'Resultados Detallados de las Cartas';
            title.style.cssText = 'color: #333; margin: 0;';
            
            const toggleButton = document.createElement('button');
            toggleButton.textContent = 'Ocultar Detalles';
            toggleButton.style.cssText = 'padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 0.9rem;';
            toggleButton.onclick = function() {
                const content = document.getElementById('detailed-results-content');
                if (content.style.display === 'none') {
                    content.style.display = 'block';
                    toggleButton.textContent = 'Ocultar Detalles';
                } else {
                    content.style.display = 'none';
                    toggleButton.textContent = 'Mostrar Detalles';
                }
            };
            
            titleContainer.appendChild(title);
            titleContainer.appendChild(toggleButton);
            detailedResultsContainer.appendChild(titleContainer);
            
            // Crear contenedor para el contenido (que se puede ocultar)
            const contentContainer = document.createElement('div');
            contentContainer.id = 'detailed-results-content';
            contentContainer.style.cssText = 'display: block;';
            detailedResultsContainer.appendChild(contentContainer);
            
            // Determinar cu√°ntos mazos hay
            const totalDecks = cardsMode === 'decks' ? selectedDecks : 1;
            const cardsPerDeck = 52;
            
            // Leer respuestas guardadas
            const userResponses = window.userCardResponses || [];
            console.log('=== LEYENDO RESPUESTAS PARA RESULTADOS ===');
            console.log('userResponses:', userResponses);
            
            // Crear un cuadro para cada mazo
            for (let deckIndex = 0; deckIndex < totalDecks; deckIndex++) {
                const deckStartIndex = deckIndex * cardsPerDeck;
                const deckEndIndex = Math.min(deckStartIndex + cardsPerDeck, cardSequence.length);
                
                // Crear contenedor para este mazo
                const deckContainer = document.createElement('div');
                deckContainer.style.cssText = 'margin-bottom: 30px; padding: 15px; background: white; border-radius: 8px; border: 1px solid #dee2e6;';
                
                // T√≠tulo del mazo
                const deckTitle = document.createElement('h4');
                deckTitle.textContent = `Mazo ${deckIndex + 1}`;
                deckTitle.style.cssText = 'color: #333; margin-bottom: 15px; text-align: center; font-size: 1.2rem;';
                deckContainer.appendChild(deckTitle);
                
                // Crear tabla de resultados para este mazo
                const table = document.createElement('table');
                table.style.cssText = 'width: 100%; border-collapse: collapse; margin-top: 10px;';
                
                // Crear encabezado de tabla
                const thead = document.createElement('thead');
                const headerRow = document.createElement('tr');
                headerRow.style.cssText = 'background: #007bff; color: white;';
                
                const headers = ['Carta', 'Tu Respuesta', 'Respuesta Correcta', 'Estado'];
                headers.forEach(headerText => {
                    const th = document.createElement('th');
                    th.textContent = headerText;
                    th.style.cssText = 'padding: 10px; text-align: center; border: 1px solid #dee2e6;';
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);
                table.appendChild(thead);
                
                // Crear cuerpo de tabla
                const tbody = document.createElement('tbody');
            
                // Procesar cartas de este mazo
                for (let i = deckStartIndex; i < deckEndIndex; i++) {
                const card = cardSequence[i];
                const userResponse = userResponses.find(r => r.cardIndex === i);
                
                if (!userResponse) {
                    console.log(`‚ùå No se encontr√≥ respuesta para carta ${i + 1}`);
                    continue;
                }
                
                // Usar valores guardados exactamente como se guardaron
                const userNumberRaw = userResponse.number || '';
                const userNumber = userNumberRaw.toLowerCase();
                const userSuit = userResponse.suit || '';
                const expectedValue = getExpectedUserValueFromImage(card);
                
                // Normalizar para mostrar en resultados
                const normalizedUserNumber = normalizeUserValue(userNumber);
                const isNumberCorrect = normalizedUserNumber === expectedValue.number.toLowerCase();
                const isSuitCorrect = userSuit === expectedValue.suit;
                const isCardCorrect = isNumberCorrect && isSuitCorrect;
                
                // Crear fila de tabla
                const row = document.createElement('tr');
                row.style.cssText = isCardCorrect ? 'background: #d4edda;' : 'background: #f8d7da;';
                
                // Columna 1: Carta original con imagen
                const cardCell = document.createElement('td');
                cardCell.style.cssText = 'padding: 8px; text-align: center; border: 1px solid #dee2e6; font-weight: bold;';
                
                // Crear imagen de la carta
                const gameMode = document.querySelector('input[name="game-mode"]:checked').value;
                let cardImageHTML = '';
                
                if (gameMode === 'symbols') {
                    // Modo s√≠mbolos - mostrar s√≠mbolos Unicode
                    const number = card.replace(/[‚ô†‚ô•‚ô¶‚ô£]/g, '');
                    const suit = card.replace(/[A-Z0-9]/g, '');
                    const suitColor = (suit === '‚ô•' || suit === '‚ô¶') ? '#dc3545' : '#333';
                    
                    // Detectar si estamos en m√≥vil para ajustar el tama√±o
                    const isMobile = window.innerWidth <= 768;
                    const isSmallMobile = window.innerWidth <= 480;
                    const cardWidth = isSmallMobile ? '45px' : isMobile ? '50px' : '60px';
                    const cardHeight = isSmallMobile ? '63px' : isMobile ? '70px' : '80px';
                    const mainFontSize = isSmallMobile ? '0.7rem' : isMobile ? '0.8rem' : '1.5rem';
                    const numberFontSize = isSmallMobile ? '0.6rem' : isMobile ? '0.7rem' : '1.2rem';
                    const marginBottom = isSmallMobile ? '1px' : isMobile ? '2px' : '5px';
                    
                    cardImageHTML = `
                        <div style="
                            width: ${cardWidth}; 
                            height: ${cardHeight}; 
                            background: white;
                            border-radius: 8px;
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            justify-content: center;
                            color: ${suitColor};
                            font-size: ${mainFontSize};
                            font-weight: bold;
                            margin: 0 auto;
                            border: 1px solid #ddd;
                        ">
                            <div style="font-size: ${numberFontSize}; margin-bottom: ${marginBottom};">${number}</div>
                            <div style="font-size: ${mainFontSize};">${suit}</div>
                        </div>
                    `;
                } else {
                    // Modo cartas - mostrar im√°genes reales
                    const { suit, value } = parseRealCard(card);
                    
                    // Mapear palos a s√≠mbolos para determinar color
                    let suitSymbol = '';
                    let suitColor = '#333';
                    switch(suit) {
                        case 'spades': suitSymbol = '‚ô†'; suitColor = '#333'; break;
                        case 'hearts': suitSymbol = '‚ô•'; suitColor = '#dc3545'; break;
                        case 'diamonds': suitSymbol = '‚ô¶'; suitColor = '#dc3545'; break;
                        case 'clubs': suitSymbol = '‚ô£'; suitColor = '#333'; break;
                    }
                    
                    // Crear clave para buscar la imagen
                    const imageKey = `custom_${value}_${suit}`;
                    const imageSrc = CARD_IMAGES_BASE64[imageKey];
                    
                    // Detectar si estamos en m√≥vil para ajustar el tama√±o
                    const isMobile = window.innerWidth <= 768;
                    const isSmallMobile = window.innerWidth <= 480;
                    const cardWidth = isSmallMobile ? '45px' : isMobile ? '50px' : '60px';
                    const cardHeight = isSmallMobile ? '63px' : isMobile ? '70px' : '80px';
                    
                    if (imageSrc) {
                        cardImageHTML = `
                            <div style="
                                width: ${cardWidth}; 
                                height: ${cardHeight}; 
                                background: white;
                                border-radius: 8px;
                                overflow: hidden;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                margin: 0 auto;
                                border: 1px solid #ddd;
                            ">
                                <img src="${imageSrc}" 
                                     alt="${value} of ${suit}" 
                                     style="
                                         width: 100%; 
                                         height: 100%; 
                                         object-fit: cover;
                                         border-radius: 7px;
                                         object-position: center;
                                     "
                                     onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\'color: #666; font-size: 0.8rem;\'>Error</div>'">
                            </div>
                        `;
                    } else {
                        // Fallback si no se encuentra la imagen
                        const fallbackFontSize = isSmallMobile ? '0.7rem' : isMobile ? '0.8rem' : '1.5rem';
                        cardImageHTML = `
                            <div style="
                                width: ${cardWidth}; 
                                height: ${cardHeight}; 
                                background: white;
                                border-radius: 8px;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: ${suitColor};
                                font-size: ${fallbackFontSize};
                                font-weight: bold;
                                margin: 0 auto;
                                border: 1px solid #ddd;
                            ">${value}</div>
                        `;
                    }
                }
                
                cardCell.innerHTML = cardImageHTML;
                row.appendChild(cardCell);
                
                // Columna 2: Respuesta del usuario
                const userResponseCell = document.createElement('td');
                const userResponseText = userNumber && userSuit ? 
                    `${userNumberRaw.toUpperCase()}${suitCodeToIcon(userSuit)}` : 
                    'Sin respuesta';
                userResponseCell.textContent = userResponseText;
                userResponseCell.style.cssText = 'padding: 8px; text-align: center; border: 1px solid #dee2e6;';
                row.appendChild(userResponseCell);
                
                // Columna 3: Respuesta correcta
                const correctResponseCell = document.createElement('td');
                const correctResponseText = `${expectedValue.number.toUpperCase()}${suitCodeToIcon(expectedValue.suit)}`;
                correctResponseCell.textContent = correctResponseText;
                correctResponseCell.style.cssText = 'padding: 8px; text-align: center; border: 1px solid #dee2e6; font-weight: bold;';
                row.appendChild(correctResponseCell);
                
                // Columna 4: Estado
                const statusCell = document.createElement('td');
                let statusText = '';
                let statusColor = '';
                
                if (!userNumber || !userSuit) {
                    statusText = '‚ùå Incompleto';
                    statusColor = '#dc3545';
                } else if (isCardCorrect) {
                    statusText = '‚úÖ Correcto';
                    statusColor = '#28a745';
                } else {
                    statusText = '‚ùå Incorrecto';
                    statusColor = '#dc3545';
                }
                
                statusCell.textContent = statusText;
                statusCell.style.cssText = `padding: 8px; text-align: center; border: 1px solid #dee2e6; color: ${statusColor}; font-weight: bold;`;
                row.appendChild(statusCell);
                
                    tbody.appendChild(row);
                }
                
                table.appendChild(tbody);
                deckContainer.appendChild(table);
                contentContainer.appendChild(deckContainer);
            }
        }

        // Funci√≥n para mostrar el resultado individual de cada ronda
        function updateRoundResult(roundAccuracy) {
            const roundNumber = document.getElementById('current-round-number');
            const roundAccuracyEl = document.getElementById('round-accuracy');
            const roundStatus = document.getElementById('round-status');
            
            if (roundNumber) roundNumber.textContent = currentRound;
            
            // Actualizar porcentaje de acierto
            if (roundAccuracyEl) {
                roundAccuracyEl.textContent = roundAccuracy + '%';
                roundAccuracyEl.className = `stat-number ${roundAccuracy === 100 ? 'correct' : 'incorrect'}`;
            }
            
            // Actualizar estado (solo Correcto o Incorrecto)
            if (roundStatus) {
                const isCorrect = roundAccuracy === 100;
                roundStatus.textContent = isCorrect ? 'Correcto' : 'Incorrecto';
                roundStatus.className = `stat-number ${isCorrect ? 'correct' : 'incorrect'}`;
            }
        }

        // Funci√≥n para calcular la mejor racha
        function calculateBestStreak() {
            let currentStreak = 0;
            let bestStreak = 0;
            
            roundScores.forEach(score => {
                if (score === 1) {
                    currentStreak++;
                    bestStreak = Math.max(bestStreak, currentStreak);
                } else {
                    currentStreak = 0;
                }
            });
            
            return bestStreak;
        }
        
        // Funci√≥n para actualizar la visualizaci√≥n de progreso
        function updateProgressDisplay() {
            const percentageList = document.getElementById('rounds-percentage-list');
            const currentScoreEl = document.getElementById('current-score');
            const currentRoundEl = document.getElementById('current-round');
            const currentPercentageEl = document.getElementById('current-percentage');
            const currentStreakEl = document.getElementById('current-streak');
            
            if (!percentageList) return;
            
            // Limpiar contenedor
            percentageList.innerHTML = '';
            
            // Crear lista simple de porcentajes por ronda
            for (let i = 1; i <= totalRounds; i++) {
                const roundDiv = document.createElement('div');
                roundDiv.style.cssText = 'margin: 10px 0; padding: 10px; border-radius: 8px; font-weight: bold;';
                
                if (i <= window.roundAccuracies.length) {
                    // Ronda completada
                    const accuracy = window.roundAccuracies[i - 1];
                    const isCorrect = accuracy === 100;
                    roundDiv.style.backgroundColor = isCorrect ? '#d4edda' : '#f8d7da';
                    roundDiv.style.color = isCorrect ? '#155724' : '#721c24';
                    roundDiv.style.border = `2px solid ${isCorrect ? '#c3e6cb' : '#f5c6cb'}`;
                    roundDiv.innerHTML = `Ronda ${i}: ${accuracy}% ${isCorrect ? '(Correcto)' : '(Incorrecto)'}<br>`;
                    // Mostrar tiempo real de memorizaci√≥n si existe
                    if (window.roundMemTimes && window.roundMemTimes[i-1]) {
                        roundDiv.innerHTML += `<span style='font-size:1rem;color:#1976d2;'>üïí ${window.roundMemTimes[i-1]} segundos</span>`;
                    }
                } else if (i === currentRound) {
                    // Ronda actual
                    roundDiv.style.backgroundColor = '#e9ecef';
                    roundDiv.style.color = '#6c757d';
                    roundDiv.style.border = '2px solid #dee2e6';
                    roundDiv.innerHTML = `Ronda ${i}: En progreso`;
                    // Mostrar tiempo real de memorizaci√≥n si existe para la ronda actual
                    if (window.roundMemTimes && window.roundMemTimes[i-1]) {
                        roundDiv.innerHTML += `<br><span style='font-size:1rem;color:#1976d2;'>üïí ${window.roundMemTimes[i-1]} segundos</span>`;
                    }
                } else {
                    // Ronda futura
                    roundDiv.style.backgroundColor = '#f8f9fa';
                    roundDiv.style.color = '#6c757d';
                    roundDiv.style.border = '2px solid #dee2e6';
                    roundDiv.textContent = `Ronda ${i}: Pendiente`;
                }
                
                percentageList.appendChild(roundDiv);
            }
            
            // Calcular estad√≠sticas
            const completedRounds = roundScores.length;
            
            // Calcular precisi√≥n total como promedio de las precisiones de cada ronda
            let totalAccuracy = 0;
            if (window.roundAccuracies && window.roundAccuracies.length > 0) {
                const totalAccuracySum = window.roundAccuracies.reduce((sum, acc) => sum + acc, 0);
                totalAccuracy = Math.round(totalAccuracySum / window.roundAccuracies.length);
            }
            
            const percentage = completedRounds > 0 ? Math.round((totalScore / completedRounds) * 100) : 0;
            const bestStreak = calculateBestStreak();
            
            // Actualizar elementos de estad√≠sticas
            if (currentScoreEl) {
                currentScoreEl.textContent = totalScore;
                currentScoreEl.className = `stat-number ${percentage >= 80 ? 'correct' : percentage >= 50 ? 'neutral' : 'incorrect'}`;
            }
            if (currentRoundEl) currentRoundEl.textContent = currentRound;
            if (currentPercentageEl) {
                currentPercentageEl.textContent = totalAccuracy + '%';
                currentPercentageEl.className = `stat-number ${totalAccuracy >= 80 ? 'correct' : totalAccuracy >= 50 ? 'neutral' : 'incorrect'}`;
            }
            if (currentStreakEl) {
                currentStreakEl.textContent = bestStreak;
                currentStreakEl.className = `stat-number ${bestStreak >= 3 ? 'correct' : bestStreak >= 1 ? 'neutral' : 'incorrect'}`;
            }
        }

        // Funci√≥n para inicializar configuraci√≥n de tiempo en resultados
        function initializeResultTimeConfig() {
            console.log('üîß Inicializando configuraci√≥n de tiempo para ronda:', currentRound);
            console.log('üîß Modo actual:', currentMode);
            console.log('üîß Modo inicial guardado:', window.initialTimeMode);
            
            // Si es la primera ronda, copiar valores actuales a los campos de resultado
            if (currentRound === 1) {
                document.getElementById('result-memorization-timer').value = memorizationTime || '';
                document.getElementById('result-auto-advance-time').value = autoAdvanceTime || '';
                
                // Guardar la configuraci√≥n inicial para mantenerla en rondas posteriores
                window.initialMemorizationTime = memorizationTime;
                window.initialAutoAdvanceTime = autoAdvanceTime;
                window.initialTimeMode = currentMode;
                
                console.log('üîß Primera ronda - Guardando configuraci√≥n inicial:', {
                    memorizationTime: window.initialMemorizationTime,
                    autoAdvanceTime: window.initialAutoAdvanceTime,
                    timeMode: window.initialTimeMode
                });
                
                // Tambi√©n aplicar la configuraci√≥n en la primera ronda
                if (currentMode === 'memorization') {
                    document.getElementById('result-memorization-mode').checked = true;
                    document.getElementById('result-auto-advance-mode').checked = false;
                    console.log('üîß Primera ronda - Aplicando modo: memorizaci√≥n');
                } else if (currentMode === 'auto-advance') {
                    document.getElementById('result-memorization-mode').checked = false;
                    document.getElementById('result-auto-advance-mode').checked = true;
                    console.log('üîß Primera ronda - Aplicando modo: autoavance');
                }
            } else {
                // Para rondas posteriores, mantener la configuraci√≥n predeterminada igual que la inicial
                // pero permitir que el usuario la modifique
                document.getElementById('result-memorization-timer').value = window.initialMemorizationTime || '';
                document.getElementById('result-auto-advance-time').value = window.initialAutoAdvanceTime || '';
                
                console.log('üîß Ronda posterior - Restaurando configuraci√≥n inicial:', {
                    memorizationTime: window.initialMemorizationTime,
                    autoAdvanceTime: window.initialAutoAdvanceTime,
                    timeMode: window.initialTimeMode
                });
                
                // Restaurar el modo inicial - mantener autoavance si estaba seleccionado
                if (window.initialTimeMode === 'memorization') {
                    document.getElementById('result-memorization-mode').checked = true;
                    document.getElementById('result-auto-advance-mode').checked = false;
                    console.log('üîß Restaurando modo: memorizaci√≥n');
                } else if (window.initialTimeMode === 'auto-advance') {
                    document.getElementById('result-memorization-mode').checked = false;
                    document.getElementById('result-auto-advance-mode').checked = true;
                    console.log('üîß Restaurando modo: autoavance');
                }
            }
            
            // Limpiar event listeners anteriores para evitar duplicados
            const resultMemorizationMode = document.getElementById('result-memorization-mode');
            const resultAutoAdvanceMode = document.getElementById('result-auto-advance-mode');
            const resultMemorizationTimer = document.getElementById('result-memorization-timer');
            const resultAutoAdvanceTime = document.getElementById('result-auto-advance-time');
            
            // Clonar elementos para remover event listeners
            const newResultMemorizationMode = resultMemorizationMode.cloneNode(true);
            const newResultAutoAdvanceMode = resultAutoAdvanceMode.cloneNode(true);
            const newResultMemorizationTimer = resultMemorizationTimer.cloneNode(true);
            const newResultAutoAdvanceTime = resultAutoAdvanceTime.cloneNode(true);
            
            resultMemorizationMode.parentNode.replaceChild(newResultMemorizationMode, resultMemorizationMode);
            resultAutoAdvanceMode.parentNode.replaceChild(newResultAutoAdvanceMode, resultAutoAdvanceMode);
            resultMemorizationTimer.parentNode.replaceChild(newResultMemorizationTimer, resultMemorizationTimer);
            resultAutoAdvanceTime.parentNode.replaceChild(newResultAutoAdvanceTime, resultAutoAdvanceTime);
            
            // Configurar eventos para los nuevos campos
            newResultMemorizationMode.addEventListener('change', function() {
                if (this.checked) {
                    updateResultModeDescription();
                }
            });
            
            newResultAutoAdvanceMode.addEventListener('change', function() {
                if (this.checked) {
                    updateResultModeDescription();
                }
            });
            
            newResultMemorizationTimer.addEventListener('input', function() {
                updateResultModeDescription();
            });
            
            newResultAutoAdvanceTime.addEventListener('input', function() {
                updateResultModeDescription();
            });
            
            updateResultModeDescription();
        }

        // Funci√≥n para configurar event listeners de resultados
        function setupResultConfiguration() {
            // Configurar modo de memorizaci√≥n en resultados
            const resultMemorizationMode = document.getElementById('result-memorization-mode');
            if (resultMemorizationMode) {
                resultMemorizationMode.addEventListener('change', function() {
                    if (this.checked) {
                        updateResultModeDescription();
                    }
                });
            }
            
            // Configurar modo de autoavance en resultados
            const resultAutoAdvanceMode = document.getElementById('result-auto-advance-mode');
            if (resultAutoAdvanceMode) {
                resultAutoAdvanceMode.addEventListener('change', function() {
                    if (this.checked) {
                        updateResultModeDescription();
                    }
                });
            }
            
            // Configurar temporizador de memorizaci√≥n en resultados
            const resultMemorizationTimer = document.getElementById('result-memorization-timer');
            if (resultMemorizationTimer) {
                resultMemorizationTimer.addEventListener('input', function() {
                    updateResultModeDescription();
                });
            }
            
            // Configurar tiempo de autoavance en resultados
            const resultAutoAdvanceTime = document.getElementById('result-auto-advance-time');
            if (resultAutoAdvanceTime) {
                resultAutoAdvanceTime.addEventListener('input', function() {
                    updateResultModeDescription();
                });
            }
        }
        
        // Funci√≥n para actualizar descripci√≥n del modo en resultados
        function updateResultModeDescription() {
            const description = document.getElementById('result-mode-description');
            const memorizationMode = document.getElementById('result-memorization-mode').checked;
            const memorizationTime = parseFloat(document.getElementById('result-memorization-timer').value) || 0;
            const autoAdvanceTime = parseFloat(document.getElementById('result-auto-advance-time').value) || 0;
            
            console.log('üîß Actualizando descripci√≥n del modo:', {
                memorizationMode: memorizationMode,
                memorizationTime: memorizationTime,
                autoAdvanceTime: autoAdvanceTime
            });
            
            if (memorizationMode) {
                if (memorizationTime > 0) {
                    description.textContent = `El juego usar√° el tiempo de memorizaci√≥n configurado (${memorizationTime.toFixed(1)} segundos).`;
                } else {
                    description.textContent = `El juego usar√° el tiempo de memorizaci√≥n configurado (escribe un tiempo).`;
                }
            } else {
                const pages = Math.ceil(selectedCards / 2);
                if (autoAdvanceTime > 0) {
                    const totalTime = pages * autoAdvanceTime;
                    description.textContent = `El juego avanzar√° autom√°ticamente cada ${autoAdvanceTime.toFixed(1)} segundos por p√°gina (${totalTime.toFixed(1)} segundos total).`;
                } else {
                    description.textContent = `El juego avanzar√° autom√°ticamente cada (escribe tiempo) segundos por p√°gina.`;
                }
            }
        }

        // Funci√≥n para siguiente ronda
        function nextRound() {
            // Actualizar configuraci√≥n de tiempo para la siguiente ronda
            const memorizationMode = document.getElementById('result-memorization-mode').checked;
            const newMemorizationTime = parseFloat(document.getElementById('result-memorization-timer').value) || 15;
            const newAutoAdvanceTime = parseFloat(document.getElementById('result-auto-advance-time').value) || 3;
            
            if (memorizationMode) {
                currentMode = 'memorization';
                memorizationTime = newMemorizationTime;
            } else {
                currentMode = 'auto-advance';
                autoAdvanceTime = newAutoAdvanceTime;
            }
            
            // Incrementar ronda
            currentRound++;
            
            // Verificar si es la √∫ltima ronda
            if (currentRound > totalRounds) {
                showFinalResults();
                return;
            }
            
            // Generar nueva secuencia de cartas completamente diferente
            console.log(`=== GENERANDO SECUENCIA PARA RONDA ${currentRound} ===`);
            generateCardSequence();
            currentCardIndex = 0;
            gameState = 'memorization';
            
            // Configurar timer seg√∫n el modo
            if (currentMode === 'auto-advance') {
                timer = autoAdvanceTime;
            } else {
                timer = memorizationTime;
            }
            
            // Mostrar fase de preparaci√≥n antes de cada nueva ronda
            const prepEl = document.getElementById('preparation-phase');
            const prepCountdownEl = document.getElementById('prep-countdown');
            if (prepEl && prepCountdownEl) {
                document.getElementById('result-phase').classList.add('hidden');
                prepEl.classList.remove('hidden');
                let prepTime = 5;
                prepCountdownEl.textContent = `${prepTime}`;
                if (window.prepInterval) clearInterval(window.prepInterval);
                window.prepInterval = setInterval(() => {
                    prepTime--;
                    prepCountdownEl.textContent = `${prepTime}`;
                    if (prepTime <= 0) {
                        clearInterval(window.prepInterval);
                        prepEl.classList.add('hidden');
                        document.getElementById('memorization-phase').classList.remove('hidden');
                        displayCards();
                        memorizationStartTime = Date.now();
                        document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
                        const memorizationInfo = document.getElementById('memorization-info');
                        const randomInfo = cardsMode === 'decks' ? 
                            `(${selectedDecks} baraja${selectedDecks > 1 ? 's' : ''} mezclada${selectedDecks > 1 ? 's' : ''} aleatoriamente)` : 
                            '(cartas seleccionadas aleatoriamente)';
                        if (currentMode === 'auto-advance') {
                            const totalPages = Math.ceil(cardSequence.length / 2);
                            memorizationInfo.textContent = `Ronda ${currentRound} - P√°gina 1 de ${totalPages}. Avanzar√° autom√°ticamente en ${autoAdvanceTime.toFixed(1)} segundos. Usa ‚Üê ‚Üí para navegar. ${randomInfo}`;
                        } else {
                            memorizationInfo.textContent = `Ronda ${currentRound} - Memoriza estas cartas. Tienes ${memorizationTime.toFixed(1)} segundos. Usa ‚Üê ‚Üí para navegar. ${randomInfo}`;
                        }
                        startTimer();
                    }
                }, 1000);
            } else {
                document.getElementById('result-phase').classList.add('hidden');
                document.getElementById('memorization-phase').classList.remove('hidden');
                displayCards();
                memorizationStartTime = Date.now();
                document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
                startTimer();
            }
            
            // Mostrar informaci√≥n de aleatorizaci√≥n
            const gameMode = document.querySelector('input[name="game-mode"]:checked').value;
            const modeText = gameMode === 'symbols' ? 's√≠mbolos' : 'im√°genes reales';
            console.log(`üéØ Ronda ${currentRound}: ${cardSequence.length} cartas en modo ${modeText}`);
            if (cardsMode === 'decks') {
                console.log(`üì¶ Distribuci√≥n: ${selectedDecks} baraja(s) mezclada(s) independientemente`);
            }
            
            document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
            
            const memorizationInfo = document.getElementById('memorization-info');
            
            // Agregar informaci√≥n sobre aleatorizaci√≥n
            const randomInfo = cardsMode === 'decks' ? 
                `(${selectedDecks} baraja${selectedDecks > 1 ? 's' : ''} mezclada${selectedDecks > 1 ? 's' : ''} aleatoriamente)` : 
                '(cartas seleccionadas aleatoriamente)';
            
            if (currentMode === 'auto-advance') {
                const totalPages = Math.ceil(cardSequence.length / 2);
                memorizationInfo.textContent = `Ronda ${currentRound} - P√°gina 1 de ${totalPages}. Avanzar√° autom√°ticamente en ${autoAdvanceTime.toFixed(1)} segundos. Usa ‚Üê ‚Üí para navegar. ${randomInfo}`;
            } else {
                memorizationInfo.textContent = `Ronda ${currentRound} - Memoriza estas cartas. Tienes ${memorizationTime.toFixed(1)} segundos. Usa ‚Üê ‚Üí para navegar. ${randomInfo}`;
            }
            
            startTimer();
        }

        // Funci√≥n para mostrar resultados finales
        function showFinalResults() {
            document.getElementById('result-phase').classList.add('hidden');
            document.getElementById('final-results-phase').classList.remove('hidden');
            
            const correctRounds = roundScores.filter(score => score === 1).length;
            const percentage = Math.round((totalScore / totalRounds) * 100);
            const bestStreak = calculateBestStreak();
            
            // Calcular precisi√≥n total como promedio de las precisiones de cada ronda
            let totalAccuracy = 0;
            if (window.roundAccuracies && window.roundAccuracies.length > 0) {
                const totalAccuracySum = window.roundAccuracies.reduce((sum, acc) => sum + acc, 0);
                totalAccuracy = Math.round(totalAccuracySum / window.roundAccuracies.length);
            }
            
            // Actualizar estad√≠sticas finales
            document.getElementById('final-score').textContent = `${totalScore}/${totalRounds}`;
            document.getElementById('final-percentage').textContent = totalAccuracy + '%';
            document.getElementById('final-streak').textContent = bestStreak;
            
            // Actualizar clases de color para estad√≠sticas finales
            const scoreElement = document.getElementById('final-score');
            const percentageElement = document.getElementById('final-percentage');
            const streakElement = document.getElementById('final-streak');
            
            scoreElement.className = `stat-number ${percentage >= 80 ? 'correct' : percentage >= 50 ? 'neutral' : 'incorrect'}`;
            percentageElement.className = `stat-number ${totalAccuracy >= 80 ? 'correct' : totalAccuracy >= 50 ? 'neutral' : 'incorrect'}`;
            streakElement.className = `stat-number ${bestStreak >= 3 ? 'correct' : bestStreak >= 1 ? 'neutral' : 'incorrect'}`;
            
            console.log('Juego completado!');
        }

        function resetGame() {
            gameState = 'setup';
            currentCardIndex = 0;
            timer = 0;
            cardSequence = [];
            
            // Reiniciar valores por defecto
            selectedCards = 0;
            selectedDecks = 0;
            cardsMode = 'specific';
            memorizationTime = 0;
            recallTime = 0;
            autoAdvanceTime = 0;
            totalRounds = 0;
            
            // Reiniciar arrays de seguimiento de rondas
            roundScores = [];
            totalScore = 0;
            currentRound = 1;
            if (window.roundAccuracies) { window.roundAccuracies = []; }
            if (window.roundMemTimes) { window.roundMemTimes = []; }
            
            // Reiniciar configuraci√≥n inicial guardada
            if (window.initialMemorizationTime) { delete window.initialMemorizationTime; }
            if (window.initialAutoAdvanceTime) { delete window.initialAutoAdvanceTime; }
            if (window.initialTimeMode) { delete window.initialTimeMode; }
            
            document.getElementById('cards-input').value = '';
            document.getElementById('decks-input').value = '';
            document.getElementById('specific-cards-mode').checked = true;
            document.getElementById('full-decks-mode').checked = false;
            document.getElementById('memorization-timer').value = '';
            document.getElementById('recall-timer').value = '';
            document.getElementById('auto-advance-time').value = '';
            document.getElementById('rounds-input').value = '';
            
            // Ocultar conversiones de tiempo
            document.getElementById('memorization-time-conversion').style.display = 'none';
            document.getElementById('recall-time-conversion').style.display = 'none';
            
            // Actualizar informaci√≥n
            updateCardsInfo();
            updateSummary();
             
            document.getElementById('result-phase').classList.add('hidden');
            document.getElementById('final-results-phase').classList.add('hidden');
            document.getElementById('memorization-phase').classList.add('hidden');
            document.getElementById('input-phase').classList.add('hidden');
            document.getElementById('setup-phase').classList.remove('hidden');
            
            // Reiniciar bot√≥n de siguiente a su estado normal
            const nextBtn = document.getElementById('next-btn');
            nextBtn.textContent = 'Siguiente ‚Üí';
            nextBtn.onclick = nextCards;
            nextBtn.disabled = false;
             
            if (timerInterval) clearInterval(timerInterval);
            if (recallTimerInterval) clearInterval(recallTimerInterval);
        }

        function goToMenu() {
            resetGame();
        }
        
        // Funci√≥n para alternar pantalla completa
        function toggleFullscreen() {
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            
            if (!document.fullscreenElement) {
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                } else if (document.documentElement.webkitRequestFullscreen) {
                    document.documentElement.webkitRequestFullscreen();
                } else if (document.documentElement.msRequestFullscreen) {
                    document.documentElement.msRequestFullscreen();
                }
                
                fullscreenBtn.textContent = '‚õ∂';
                fullscreenBtn.title = 'Salir Pantalla Completa';
                fullscreenBtn.classList.add('fullscreen');
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
                
                fullscreenBtn.textContent = '‚õ∂';
                fullscreenBtn.title = 'Pantalla Completa';
                fullscreenBtn.classList.remove('fullscreen');
            }
        }
        
        // Inicializaci√≥n al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            updateCardsInfo();
            updateDisplayInfo();
            updateRoundsInfo();
            updateSummary();
            updateProgressDisplay();
            
            // Event listeners para actualizar configuraci√≥n en tiempo real
            document.getElementById('specific-cards-mode').addEventListener('change', function() {
                updateCardsInfo();
                updateSummary();
            });
            
            document.getElementById('full-decks-mode').addEventListener('change', function() {
                updateCardsInfo();
                updateSummary();
            });
            
            document.getElementById('cards-input').addEventListener('input', function() {
                updateCardsInfo();
                updateSummary();
            });
            
            document.getElementById('decks-input').addEventListener('input', function() {
                updateCardsInfo();
                updateSummary();
            });
            
            document.getElementById('rounds-input').addEventListener('input', function() {
                updateRoundsInfo();
                updateSummary();
            });
            
            document.getElementById('memorization-timer').addEventListener('input', function() {
                updateSummary();
                updateModeDescription();
            });
            
            document.getElementById('recall-timer').addEventListener('input', function() {
                updateSummary();
            });
            
            document.getElementById('auto-advance-time').addEventListener('input', function() {
                updateSummary();
                updateModeDescription();
            });
            
            document.getElementById('memorization-mode').addEventListener('change', function() {
                updateSummary();
                updateModeDescription();
            });
            
            document.getElementById('auto-advance-mode').addEventListener('change', function() {
                updateSummary();
                updateModeDescription();
            });
            
            // Event listeners para modo de visualizaci√≥n
            document.getElementById('pairs-mode').addEventListener('change', function() {
                updateDisplayInfo();
                updateCardsInfo();
                updateSummary();
            });
            
            document.getElementById('single-mode').addEventListener('change', function() {
                updateDisplayInfo();
                updateCardsInfo();
                updateSummary();
            });
            
            // Event listeners para modo de juego
            document.getElementById('symbols-mode').addEventListener('change', function() {
                updateSummary();
                updateCardsInfo(); // Actualizar mensaje informativo del modo cartas
            });
            
            document.getElementById('cards-mode').addEventListener('change', function() {
                updateSummary();
                updateCardsInfo(); // Actualizar mensaje informativo del modo cartas
            });
        });
    </script>
</body>
</html>
