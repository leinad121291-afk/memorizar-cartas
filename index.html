<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cartas Poker - Con Autoavance</title>
    <script src="base64_images_data.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Arial', sans-serif;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 800px;
            width: 100%;
        }

        .title {
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }

        .phase-title {
            color: #666;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .section {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }

        .section-title {
            color: #333 !important;
            margin-bottom: 15px !important;
            font-size: 1.3rem !important;
            font-weight: bold !important;
        }
        
        /* Asegurar que todos los títulos de sección tengan el mismo tamaño */
        h3.section-title {
            color: #333 !important;
            margin-bottom: 15px !important;
            font-size: 1.3rem !important;
            font-weight: bold !important;
        }
        
        /* Selector aún más específico para garantizar consistencia */
        .section h3.section-title {
            color: #333 !important;
            margin-bottom: 15px !important;
            font-size: 1.3rem !important;
            font-weight: bold !important;
        }
        
        /* Forzar el tamaño de fuente para todos los títulos de sección */
        h3[class*="section-title"] {
            color: #333 !important;
            margin-bottom: 15px !important;
            font-size: 1.3rem !important;
            font-weight: bold !important;
        }
        
        /* Selector de máxima especificidad */
        div.section > h3.section-title {
            color: #333 !important;
            margin-bottom: 15px !important;
            font-size: 1.3rem !important;
            font-weight: bold !important;
        }
        
        /* Selector de máxima especificidad para forzar el tamaño */
        body div.section h3.section-title {
            color: #333 !important;
            margin-bottom: 15px !important;
            font-size: 1.3rem !important;
            font-weight: bold !important;
        }
        
        /* Selector ultra específico para todos los elementos h3 en secciones */
        
        body * h3.section-title,
        body h3.section-title,
        html body h3.section-title {
            font-size: 1.3rem !important;
            font-weight: bold !important;
            color: #333 !important;
            margin-bottom: 15px !important;
        }

        .card-display {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .poker-card {
            width: 140px;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .poker-card svg,
        .poker-card img {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .card-red {
            color: #dc3545;
        }

        .card-black {
            color: #333;
        }

        .card-input {
            width: 120px;
            height: 50px;
            border: 3px solid #ddd;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            text-align: center;
            background: #f8f9fa;
            color: #333;
            font-family: 'Courier New', monospace;
            transition: all 0.3s;
        }

        .card-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            transform: scale(1.05);
        }

        .card-input.correct {
            border-color: #28a745;
            background-color: #d4edda;
            color: #155724;
        }

        .card-input.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .card-number-select {
            width: 80px;
            height: 45px;
            border: 3px solid #ddd;
            border-radius: 8px 8px 0 0;
            font-size: 1.8rem;
            font-weight: bold;
            text-align: center;
            background: #f8f9fa;
            color: #333;
            font-family: 'Arial', sans-serif;
            transition: all 0.3s;
        }
        
        .card-number-select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            transform: scale(1.02);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        .card-number-select.correct {
            border-color: #28a745;
            background-color: #d4edda;
            color: #155724;
        }
        
        .card-number-select.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }

        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.2rem;
            cursor: pointer;
            margin: 10px;
            transition: transform 0.2s;
        }

        .button:hover {
            transform: translateY(-2px);
        }

        .button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .hidden {
            display: none;
        }

        .timer {
            font-size: 1.2rem;
            color: #666;
            margin: 10px 0;
        }

        .progress-indicator {
            font-size: 1.1rem;
            color: #666;
            margin: 15px 0;
        }

        .result-message {
            font-size: 1.5rem;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
        }

        .correct-result {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .incorrect-result {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin: 20px 0;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .card-input-row {
            display: flex;
            flex-direction: column;
            width: 100%;
            justify-content: center;
            align-items: center;
            gap: 0px;
            position: relative;
            margin: 8px 0;
        }
        
        /* Ajustes para el nuevo sistema de grid */
        .card-number-select {
            margin-bottom: 0;
        }
        
        .suit-select {
            margin-top: 0;
        }
 
        .card-input {
            width: 55px;
            height: 25px;
            border: 2px solid #ddd;
            border-radius: 6px 6px 0 0;
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            background: #f8f9fa;
            color: #333;
            font-family: 'Arial', sans-serif;
            transition: all 0.3s;
        }
 
        .suit-select {
            width: 80px;
            height: 45px;
            border: 2px solid #ddd;
            border-top: none;
            border-radius: 0 0 8px 8px;
            font-size: 1.8rem;
            background: white;
            color: #333;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .suit-select:focus {
            outline: none;
            border-color: #667eea;
            transform: scale(1.02);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .suit-select.correct {
            border-color: #28a745;
            background-color: #d4edda;
            color: #155724;
        }

        .suit-select.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
            color: #721c24;
        }

        .suit-select option[value="P"] {
            color: #333;
        }

        .suit-select option[value="C"] {
            color: #dc3545;
        }

        .suit-select option[value="D"] {
            color: #dc3545;
        }

        .suit-select option[value="T"] {
            color: #333;
        }

        .fullscreen-button {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%) !important;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 1.2rem;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.2s;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            min-width: 40px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fullscreen-button:hover {
            transform: translateY(-2px);
        }

        /* Estilos para sistema de rondas */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border: 2px solid #e9ecef;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-number.correct {
            color: #28a745;
        }

        .stat-number.incorrect {
            color: #dc3545;
        }

        .stat-number.neutral {
            color: #6c757d;
        }

        .chart-container {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .pie-chart {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(#28a745 0deg, #28a745 0deg, #e9ecef 0deg);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .pie-chart-text {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }

        .chart-label {
            text-align: center;
            margin-top: 10px;
            font-weight: bold;
            color: #333;
        }

        .rounds-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .round-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border: 2px solid #e9ecef;
        }

        .round-item.correct {
            border-color: #28a745;
            background-color: #d4edda;
        }

        .round-item.incorrect {
            border-color: #dc3545;
            background-color: #f8d7da;
        }

        /* Estilos para configuración de tiempo en resultados */
        .mode-selector {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 15px 0;
        }

        .mode-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: white;
        }

        .mode-radio {
            margin: 0;
        }

        .timer-select {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            width: 120px;
        }

        .small-input {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            width: 80px;
        }

        @media (max-width: 768px) {
            .game-container {
                padding: 20px;
            }
            
            .card-display {
                font-size: 2rem;
            }
            
            .cards-grid {
                gap: 10px;
                grid-template-columns: repeat(2, 1fr);
            }
            
            .poker-card {
                width: 120px;
                height: 160px;
            }
            
            .card-corner {
                font-size: 1.2rem;
            }
            
            .card-suit {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <button class="fullscreen-button" id="fullscreen-btn" onclick="toggleFullscreen()" title="Pantalla Completa">⛶</button>
        <h1 class="title">Cartas Poker</h1>
        
        <!-- Fase de Configuración -->
        <div id="setup-phase">
            <h2 class="phase-title">Configuración del Juego</h2>
            
                         <!-- Cartas a Memorizar -->
             <div class="section">
                 <h3 class="section-title">1. Configuración de Cartas</h3>
                 
                 <!-- Selección de Modo de Juego -->
                 <div style="margin-bottom: 25px;">
                     <p style="font-size: 1.1rem; color: #333; margin-bottom: 15px; font-weight: bold;">Elige el modo de juego:</p>
                     <div style="display: flex; justify-content: center; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
                         <div style="display: flex; align-items: center; gap: 10px; margin: 10px 0; padding: 15px; border: 2px solid #e9ecef; border-radius: 8px; background: white; min-width: 200px;">
                             <input type="radio" id="symbols-mode" name="game-mode" value="symbols" checked>
                             <label for="symbols-mode" style="font-weight: bold; color: #333;">Modo Símbolos</label>
                             <span style="font-size: 0.9rem; color: #666;">(♠♥♦♣)</span>
                         </div>
                         
                         <div style="display: flex; align-items: center; gap: 10px; margin: 10px 0; padding: 15px; border: 2px solid #e9ecef; border-radius: 8px; background: white; min-width: 200px;">
                             <input type="radio" id="cards-mode" name="game-mode" value="cards">
                             <label for="cards-mode" style="font-weight: bold; color: #333;">Modo Cartas</label>
                             <span style="font-size: 0.9rem; color: #666;">(Imágenes reales)</span>
                         </div>
                     </div>
                 </div>
                 
                 <!-- Opciones de configuración -->
                 <div style="margin-bottom: 20px;">
                     <p>Elige el tipo de memorización:</p>
                     <div style="display: flex; justify-content: center; gap: 20px; margin: 15px 0; flex-wrap: wrap;">
                         <div style="display: flex; align-items: center; gap: 10px;">
                             <input type="radio" id="specific-cards-mode" name="cards-mode" value="specific" checked>
                             <label for="specific-cards-mode">Número específico de cartas:</label>
                             <input type="number" id="cards-input" class="card-input" min="1" max="52" value="" placeholder="5" style="width: 80px;">
                             <span style="font-size: 1.1rem; color: #333;">cartas</span>
                         </div>
                         
                         <div style="display: flex; align-items: center; gap: 10px;">
                             <input type="radio" id="full-decks-mode" name="cards-mode" value="decks">
                             <label for="full-decks-mode">Barajas completas:</label>
                             <input type="number" id="decks-input" class="card-input" min="1" max="10" value="" placeholder="1" style="width: 80px;">
                             <span style="font-size: 1.1rem; color: #333;">barajas</span>
                         </div>
                     </div>
                 </div>
                 
                 <p id="selected-info">Memorizarás 5 cartas específicas (2 cartas por página)</p>
                 <p id="deck-info" style="font-size: 0.9rem; color: #666; margin-top: 5px;">Total disponible: 52 cartas únicas</p>
             </div>

            <!-- Configuración de Temporizadores -->
            <div class="section">
                <h3 class="section-title">2. Configuración de Temporizadores</h3>
                
                <div style="display: flex; justify-content: center; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 10px; margin: 10px 0;">
                                        <label for="recall-timer">Tiempo para recall (segundos):</label>
                <input type="number" id="recall-timer" style="padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;" min="1" max="3600" step="0.1" value="" placeholder="30">
                <div id="recall-time-conversion" style="font-size: 0.9rem; color: #666; margin-top: 5px;"></div>
                    </div>
                </div>
            </div>
            
            <!-- Configuración de Rondas -->
            <div class="section">
                <h3 class="section-title">3. Configuración de Rondas</h3>
                <p>Elige cuántas rondas quieres jugar:</p>
                <div style="display: flex; justify-content: center; align-items: center; gap: 15px; margin: 20px 0;">
                    <input type="number" id="rounds-input" class="card-input" min="1" max="100" value="" placeholder="10">
                    <span style="font-size: 1.1rem; color: #333;">rondas</span>
                </div>
                <p id="rounds-info">Jugarás 10 rondas en total</p>
            </div>

            <!-- Configuración de Autoavance -->
            <div class="section">
                <h3 class="section-title">4. Configuración de Tiempo de Memorización</h3>
                
                <div style="display: flex; justify-content: center; gap: 20px; margin: 20px 0; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 10px; margin: 10px 0;">
                        <input type="radio" id="memorization-mode" name="time-mode" value="memorization" checked>
                        <label for="memorization-mode">Tiempo para memorización (segundos):</label>
                        <input type="number" id="memorization-timer" style="padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem;" min="1" max="999999" step="0.1" value="" placeholder="15">
                        <div id="memorization-time-conversion" style="font-size: 0.9rem; color: #666; margin-top: 5px;"></div>
                    </div>
                    
                    <div style="display: flex; align-items: center; gap: 10px; margin: 10px 0;">
                        <input type="radio" id="auto-advance-mode" name="time-mode" value="auto-advance">
                        <label for="auto-advance-mode">Autoavance (segundos):</label>
                        <input type="number" id="auto-advance-time" style="font-size: 1rem; padding: 8px 12px; border: 2px solid #ddd; border-radius: 6px; text-align: center; width: 80px; margin: 0 10px;" min="0.1" max="60" step="0.1" value="" placeholder="3">
                    </div>
                </div>
                
                <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">
                    <span id="mode-description">El juego usará el tiempo de memorización configurado.</span>
                </p>
            </div>

            <!-- Resumen de Configuración -->
            <div style="background: #e3f2fd; border-radius: 10px; padding: 20px; margin: 20px 0; border: 2px solid #bbdefb;" id="config-summary">
                <h3>Resumen de Configuración</h3>
                <p id="summary-cards">Cartas: 5</p>
                <p id="summary-rounds">Rondas: 10</p>
                <p id="summary-timers">Temporizadores: Memorización 15s, Recall 30s</p>
                <p id="summary-mode">Modo: Tiempo de memorización</p>
            </div>
            
            <button class="button" onclick="startGame()">Comenzar Juego</button>
        </div>

        <!-- Fase de Memorización -->
        <div id="memorization-phase" class="hidden">
            <h2 class="phase-title">Fase de Memorización</h2>
            <div class="timer" id="timer">Tiempo restante: 15 segundos</div>
            
            <!-- Contenedor principal con posición fija para las cartas -->
            <div style="position: relative; margin: 20px 0;">
                <!-- Indicador de mazo simplificado -->
                <div id="deck-indicator" style="
                    position: absolute;
                    left: 30px;
                    top: 80px;
                    background: #007bff;
                    color: white;
                    padding: 15px;
                    border-radius: 50%;
                    font-weight: bold;
                    font-size: 1.8rem;
                    width: 60px;
                    height: 60px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    box-shadow: 0 3px 8px rgba(0,0,0,0.2);
                    display: none;
                    z-index: 10;
                ">
                    <span id="current-deck-indicator">1</span>
                </div>
                
                <!-- Contenedor de cartas en posición original -->
                <div style="width: 100%;">
            <div class="card-display" id="card-display"></div>
            <div class="progress-indicator" id="progress">Cartas 1-2 de 5</div>
            <div style="margin: 20px 0;">
                <button class="button" id="prev-btn" onclick="previousCards()" disabled>← Anterior</button>
                <button class="button" id="next-btn" onclick="nextCards()">Siguiente →</button>
            </div>
            <p id="memorization-info">Memoriza estas cartas. Tienes 15 segundos.</p>
            <div style="margin: 30px 0;">
                <button class="button" id="finish-memorization-btn" onclick="finishMemorization()">Terminar Memorización</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fase de Escritura -->
        <div id="input-phase" class="hidden">
            <h2 class="phase-title">Escribe las Cartas</h2>
            <div class="timer" id="recall-timer-display">Tiempo restante: 30 segundos</div>
                             <p>Escribe las cartas que memorizaste:</p>
                 <p style="font-size: 0.9rem; color: #666; margin: 10px 0;">
                     <strong>Formato:</strong> Escribe la carta (ej: As, Rey, 10) y selecciona el palo del desplegable
                 </p>
                 <div id="cards-input-container" class="cards-grid"></div>
            <div>
                <button class="button" onclick="verifyCardAnswers()" id="verify-btn">Verificar Respuesta</button>
                <button class="button" onclick="showCardsAgain()" id="show-again-btn">Ver de Nuevo</button>
            </div>
        </div>

        <!-- Fase de Resultado -->
        <div id="result-phase" class="hidden">
            <h2 class="phase-title">Resultado Ronda <span id="current-round-display">1</span></h2>
            <div id="result-message"></div>
            
            <!-- Resultado de la Ronda Actual -->
            <div class="section">
                <h3 class="section-title">Resultado Ronda <span id="current-round-number">1</span></h3>
                
                <!-- Estadísticas de la ronda -->
                <div class="stats-grid" id="round-stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Porcentaje de Acierto</div>
                        <div class="stat-number neutral" id="round-accuracy">0%</div>
                        <div style="font-size: 0.9rem; color: #666;">cartas correctas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Estado</div>
                        <div class="stat-number neutral" id="round-status">Pendiente</div>
                        <div style="font-size: 0.9rem; color: #666;">de la ronda</div>
                    </div>
                </div>
            </div>
            
            <!-- Progresión de Rondas -->
            <div class="section">
                <h3 class="section-title">Progresión de Rondas</h3>
                
                <!-- Lista simple de porcentajes por ronda -->
                <div id="rounds-percentage-list" style="margin: 20px 0; text-align: center;">
                    <!-- Aquí se mostrarán los porcentajes de cada ronda -->
                </div>
                
                <!-- Estadísticas totales -->
                <div class="stats-grid" id="progress-stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Rondas Correctas</div>
                        <div class="stat-number neutral" id="current-score">0</div>
                        <div style="font-size: 0.9rem; color: #666;">de <span id="current-round">1</span></div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Promedio Precisión</div>
                        <div class="stat-number neutral" id="current-percentage">0%</div>
                        <div style="font-size: 0.9rem; color: #666;">de cartas correctas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Mejor Racha</div>
                        <div class="stat-number neutral" id="current-streak">0</div>
                        <div style="font-size: 0.9rem; color: #666;">consecutivas</div>
                    </div>
                </div>
            </div>
            
            <!-- Configuración de tiempo para siguiente ronda -->
            <div class="section">
                <h3 class="section-title">Configuración para Siguiente Ronda</h3>
                
                <div class="mode-selector">
                    <div class="mode-option">
                        <input type="radio" id="result-memorization-mode" name="result-time-mode" value="memorization" class="mode-radio" checked>
                        <label for="result-memorization-mode">Tiempo para memorización (segundos):</label>
                        <input type="number" id="result-memorization-timer" class="timer-select" min="1" max="999999" step="0.1" value="" placeholder="15">
                        <div id="result-memorization-time-conversion" style="font-size: 0.9rem; color: #666; margin-top: 5px;"></div>
                    </div>
                    
                    <div class="mode-option">
                        <input type="radio" id="result-auto-advance-mode" name="result-time-mode" value="auto-advance" class="mode-radio">
                        <label for="result-auto-advance-mode">Autoavance (segundos):</label>
                        <input type="number" id="result-auto-advance-time" class="small-input" min="0.1" max="60" step="0.1" value="" placeholder="3">
                    </div>
                </div>
                
                <p style="font-size: 0.9rem; color: #666; margin-top: 10px;">
                    <span id="result-mode-description">El juego usará el tiempo de memorización configurado.</span>
                </p>
            </div>
            
            <div id="round-progress">
                <p>Ronda <span id="round-number">1</span> de <span id="total-rounds">10</span></p>
                <div style="width: 100%; height: 20px; background: #e9ecef; border-radius: 10px; margin: 15px 0; overflow: hidden;">
                    <div style="height: 100%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); transition: width 0.3s ease; width: 0%;" id="round-progress-fill"></div>
                </div>
            </div>
            <div>
                <button class="button" onclick="nextRound()" id="next-round-btn">Siguiente Ronda</button>
                <button class="button" onclick="resetGame()" id="new-game-btn">Nuevo Juego</button>
                <button class="button" onclick="goToMenu()" id="menu-btn" style="display: none;">Menú</button>
            </div>
        </div>
        
        <!-- Fase de Resultados Finales -->
        <div id="final-results-phase" class="hidden">
            <h2 class="phase-title">¡Juego Completado!</h2>
            
            <!-- Gráficas circulares principales -->
            <div class="chart-container">
                <div>
                    <div class="pie-chart" id="final-accuracy-chart">
                        <div class="pie-chart-text">0%</div>
                    </div>
                    <div class="chart-label">Precisión Final</div>
                </div>
                <div>
                    <div class="pie-chart" id="final-score-chart">
                        <div class="pie-chart-text">0/10</div>
                    </div>
                    <div class="chart-label">Progreso</div>
                </div>
                <div>
                    <div class="pie-chart" id="final-streak-chart">
                        <div class="pie-chart-text">0</div>
                    </div>
                    <div class="chart-label">Mejor Racha</div>
                </div>
            </div>
            
            <!-- Estadísticas finales -->
            <div class="section">
                <h3 class="section-title">Estadísticas Finales</h3>
                <div class="stats-grid" id="final-stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Puntuación Total</div>
                        <div class="stat-number neutral" id="final-score">0/10</div>
                        <div style="font-size: 0.9rem; color: #666;">rondas correctas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Porcentaje Final</div>
                        <div class="stat-number neutral" id="final-percentage">0%</div>
                        <div style="font-size: 0.9rem; color: #666;">de precisión</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Mejor Racha</div>
                        <div class="stat-number neutral" id="final-streak">0</div>
                        <div style="font-size: 0.9rem; color: #666;">consecutivas</div>
                    </div>
                </div>
            </div>
            
            <!-- Desglose de rondas -->
            <div class="section">
                <h3 class="section-title">Desglose por Rondas</h3>
                <div class="rounds-grid" id="final-rounds-breakdown"></div>
            </div>
            
            <div>
                <button class="button" onclick="resetGame()" id="final-new-game-btn">Nuevo Juego</button>
                <button class="button" onclick="goToMenu()" id="final-menu-btn">Menú</button>
            </div>
        </div>
    </div>

    <script>
                 // Variables del juego
         let gameState = 'setup';
         let selectedCards = 5;
         let selectedDecks = 1;
         let cardsMode = 'specific'; // 'specific' o 'decks'
         let cardSequence = [];
         let currentCardIndex = 0;
         let timer = 0;
         let memorizationTime = 15;
         let recallTime = 30;
         let timerInterval;
         let recallTimerInterval;
         let memorizationStartTime = 0;
         let actualMemorizationTime = 0;
         
         // Variables para autoavance
         let autoAdvanceEnabled = false;
         let autoAdvanceTime = 3;
         let currentMode = 'memorization';
         
         // Variables para sistema de rondas
         let currentRound = 1;
         let totalRounds = 10;
         let roundScores = [];
         let totalScore = 0;

                 // Cartas de poker disponibles (con símbolos para mostrar, letras para input)
         const pokerCards = [
             'A♠', 'A♥', 'A♦', 'A♣',
             'K♠', 'K♥', 'K♦', 'K♣',
             'Q♠', 'Q♥', 'Q♦', 'Q♣',
             'J♠', 'J♥', 'J♦', 'J♣',
             '10♠', '10♥', '10♦', '10♣',
             '9♠', '9♥', '9♦', '9♣',
             '8♠', '8♥', '8♦', '8♣',
             '7♠', '7♥', '7♦', '7♣',
             '6♠', '6♥', '6♦', '6♣',
             '5♠', '5♥', '5♦', '5♣',
             '4♠', '4♥', '4♦', '4♣',
             '3♠', '3♥', '3♦', '3♣',
             '2♠', '2♥', '2♦', '2♣'
         ];

        // Cartas con imágenes reales (formato: [palo]_[valor])
        const realCards = [
            'spades_A', 'hearts_A', 'diamonds_A', 'clubs_A',
            'spades_K', 'hearts_K', 'diamonds_K', 'clubs_K',
            'spades_Q', 'hearts_Q', 'diamonds_Q', 'clubs_Q',
            'spades_J', 'hearts_J', 'diamonds_J', 'clubs_J',
            'spades_10', 'hearts_10', 'diamonds_10', 'clubs_10',
            'spades_9', 'hearts_9', 'diamonds_9', 'clubs_9',
            'spades_8', 'hearts_8', 'diamonds_8', 'clubs_8',
            'spades_7', 'hearts_7', 'diamonds_7', 'clubs_7',
            'spades_6', 'hearts_6', 'diamonds_6', 'clubs_6',
            'spades_5', 'hearts_5', 'diamonds_5', 'clubs_5',
            'spades_4', 'hearts_4', 'diamonds_4', 'clubs_4',
            'spades_3', 'hearts_3', 'diamonds_3', 'clubs_3',
            'spades_2', 'hearts_2', 'diamonds_2', 'clubs_2'
        ];

        // Función para convertir carta con símbolos a formato de input
        function cardToInputFormat(card) {
            return card.replace('♠', 'P').replace('♥', 'C').replace('♦', 'D').replace('♣', 'T');
        }

        // Función para convertir input a carta con símbolos
        function inputToCardFormat(input) {
            return input.replace('P', '♠').replace('C', '♥').replace('D', '♦').replace('T', '♣');
        }

        // Función para normalizar valores del usuario (1 = A, 11 = J, 12 = Q, 13 = K)
        function normalizeUserValue(userValue) {
            const value = userValue.toLowerCase().trim();
            
            // Mapear valores numéricos a letras
            switch(value) {
                case '1': return 'a';
                case '11': return 'j';
                case '12': return 'q';
                case '13': return 'k';
                default: return value;
            }
        }
        
        // Función para convertir códigos de palos a iconos
        function suitCodeToIcon(suitCode) {
            switch(suitCode) {
                case 'P': return '♠';
                case 'C': return '♥';
                case 'D': return '♦';
                case 'T': return '♣';
                default: return suitCode;
            }
        }

        // Función para obtener valores esperados de una carta (número y palo)
        function getExpectedUserValueFromImage(card) {
            // Obtener el modo de juego seleccionado
            const gameMode = document.querySelector('input[name="game-mode"]:checked').value;
            
            if (gameMode === 'symbols') {
                // Modo símbolos - extraer de símbolos Unicode
                const number = card.replace(/[♠♥♦♣]/g, ''); // Remover símbolos para obtener número
                const suit = card.replace(/[A-Z0-9]/g, ''); // Remover letras/números para obtener palo
                
                // Mapear símbolos a códigos de palo
                let suitCode = '';
                switch(suit) {
                    case '♠': suitCode = 'P'; break; // Picas
                    case '♥': suitCode = 'C'; break; // Corazones
                    case '♦': suitCode = 'D'; break; // Diamantes
                    case '♣': suitCode = 'T'; break; // Tréboles
                    default: suitCode = suit;
                }
                
                return {
                    number: number,
                    suit: suitCode
                };
            } else {
                // Modo cartas - usar función para cartas reales
                return getExpectedUserValueFromRealCard(card);
            }
        }

        // Función para extraer información de una carta con imagen real
        function parseRealCard(cardName) {
            // Formato: [palo]_[valor]
            const parts = cardName.split('_');
            if (parts.length >= 2) {
                const suit = parts[0];
                const value = parts[1];
                return { suit, value };
            }
            return { suit: 'spades', value: 'A' };
        }

        // Función para obtener la ruta de imagen de una carta real
        function getRealCardImagePath(cardName) {
            return `images/cartas_reales/${cardName}.png`;
        }

        // Función para convertir carta real a formato de input
        function realCardToInputFormat(cardName) {
            const { suit, value } = parseRealCard(cardName);
            
            // Mapear palos a códigos
            let suitCode = '';
            switch(suit) {
                case 'spades': suitCode = 'P'; break;
                case 'hearts': suitCode = 'C'; break;
                case 'diamonds': suitCode = 'D'; break;
                case 'clubs': suitCode = 'T'; break;
                default: suitCode = 'P';
            }
            
            return { number: value, suit: suitCode };
        }

        // Función para obtener valores esperados de una carta real
        function getExpectedUserValueFromRealCard(cardName) {
            return realCardToInputFormat(cardName);
        }

        // Función para generar el patrón de una carta según su valor usando imágenes reales
        function generateCardPattern(value, suitSymbol, suitColor) {
            const displayValue = value.toUpperCase();
            
            // Cartas especiales (A, K, Q, J)
            if (['A', 'K', 'Q', 'J'].includes(displayValue)) {
                return generateSpecialCardImage(displayValue, suitSymbol, suitColor);
            }
            
            // Cartas numéricas (2-10)
            const numValue = parseInt(value);
            if (numValue >= 2 && numValue <= 10) {
                return generateNumberCardImage(numValue, suitSymbol, suitColor);
            }
            
            // Fallback para valores desconocidos
            return generateSimpleCardImage(displayValue, suitSymbol, suitColor);
        }

        // Función para generar cartas especiales (A, K, Q, J) usando imágenes reales
        function generateSpecialCardImage(value, suitSymbol, suitColor) {
            // Mapear palos a nombres de archivo
            let suitName = '';
            switch(suitSymbol) {
                case '♠': suitName = 'spades'; break;
                case '♥': suitName = 'hearts'; break;
                case '♦': suitName = 'diamonds'; break;
                case '♣': suitName = 'clubs'; break;
                default: suitName = 'spades';
            }
            
            // Crear clave para buscar la imagen
            const imageKey = `custom_${value}_${suitName}`;
            const imageSrc = CARD_IMAGES_BASE64[imageKey];
            
            if (imageSrc) {
                return `
                    <div style="
                        width: 100%; 
                        height: 100%; 
                        background: white;
                        border-radius: 8px;
                        border: 1px solid #d1d5db;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                        overflow: hidden;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    ">
                        <img src="${imageSrc}" 
                             alt="${value} of ${suitName}" 
                             style="
                                 width: 100%; 
                                 height: 100%; 
                                 object-fit: contain;
                                 border-radius: 7px;
                             "
                             onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\'color: #666; font-size: 1.2rem;\'>Error cargando imagen</div>'">
                    </div>
                `;
            } else {
                // Fallback si no se encuentra la imagen
                return `
                    <div style="
                        width: 100%; 
                        height: 100%; 
                        background: white;
                        border-radius: 8px;
                        border: 1px solid #d1d5db;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: ${suitColor};
                        font-size: 3rem;
                        font-weight: bold;
                    ">${value}</div>
                `;
            }
        }

        // Función para generar cartas numéricas (2-10) usando imágenes reales
        function generateNumberCardImage(numValue, suitSymbol, suitColor) {
            // Mapear palos a nombres de archivo
            let suitName = '';
            switch(suitSymbol) {
                case '♠': suitName = 'spades'; break;
                case '♥': suitName = 'hearts'; break;
                case '♦': suitName = 'diamonds'; break;
                case '♣': suitName = 'clubs'; break;
                default: suitName = 'spades';
            }
            
            // Crear clave para buscar la imagen
            const imageKey = `custom_${numValue}_${suitName}`;
            const imageSrc = CARD_IMAGES_BASE64[imageKey];
            
            if (imageSrc) {
                return `
                    <div style="
                        width: 100%; 
                        height: 100%; 
                        background: white;
                        border-radius: 8px;
                        border: 1px solid #d1d5db;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                        overflow: hidden;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    ">
                        <img src="${imageSrc}" 
                             alt="${numValue} of ${suitName}" 
                             style="
                                 width: 100%; 
                                 height: 100%; 
                                 object-fit: contain;
                                 border-radius: 7px;
                             "
                             onerror="this.style.display='none'; this.parentElement.innerHTML='<div style=\'color: #666; font-size: 1.2rem;\'>Error cargando imagen</div>'">
                    </div>
                `;
            } else {
                // Fallback si no se encuentra la imagen
                return `
                    <div style="
                        width: 100%; 
                        height: 100%; 
                        background: white;
                        border-radius: 8px;
                        border: 1px solid #d1d5db;
                        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        color: ${suitColor};
                        font-size: 2rem;
                        font-weight: bold;
                    ">${numValue}</div>
                `;
            }
        }

                 // Función para generar carta simple (fallback) usando imágenes reales
         function generateSimpleCardImage(value, suitSymbol, suitColor) {
             return `
                 <div style="
                     width: 100%; 
                     height: 100%; 
                     background: white;
                     border-radius: 8px;
                     border: 1px solid #d1d5db;
                     box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                     display: flex;
                     align-items: center;
                     justify-content: center;
                     color: ${suitColor};
                     font-size: 2rem;
                     font-weight: bold;
                 ">${value}</div>
             `;
         }

        // Función para generar secuencia de cartas
        function generateCardSequence() {
            cardSequence = [];
            
            if (cardsMode === 'specific') {
                // Generar cartas específicas
                const gameMode = document.querySelector('input[name="game-mode"]:checked').value;
                
                if (gameMode === 'symbols') {
                    // Modo símbolos - usar pokerCards
                    const shuffled = [...pokerCards].sort(() => Math.random() - 0.5);
                    cardSequence = shuffled.slice(0, selectedCards);
                } else {
                    // Modo cartas - usar realCards
                    const shuffled = [...realCards].sort(() => Math.random() - 0.5);
                    cardSequence = shuffled.slice(0, selectedCards);
                }
            } else {
                // Generar barajas completas
                const gameMode = document.querySelector('input[name="game-mode"]:checked').value;
                
                if (gameMode === 'symbols') {
                    // Repetir pokerCards según el número de barajas
                    for (let i = 0; i < selectedDecks; i++) {
                        cardSequence = cardSequence.concat([...pokerCards]);
                    }
                } else {
                    // Repetir realCards según el número de barajas
                    for (let i = 0; i < selectedDecks; i++) {
                        cardSequence = cardSequence.concat([...realCards]);
                    }
                }
            }
            
            console.log('Secuencia generada:', cardSequence);
        }

        // Función para mostrar cartas en la fase de memorización
        function displayCards() {
            const cardDisplay = document.getElementById('card-display');
            const gameMode = document.querySelector('input[name="game-mode"]:checked').value;
            
            cardDisplay.innerHTML = '';
            
            // Calcular qué cartas mostrar (2 por página)
            const startIndex = currentCardIndex;
            const endIndex = Math.min(startIndex + 2, cardSequence.length);
            const cardsToShow = cardSequence.slice(startIndex, endIndex);
            
            cardsToShow.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'poker-card';
                
                if (gameMode === 'symbols') {
                    // Modo símbolos - mostrar símbolos Unicode
                    const number = card.replace(/[♠♥♦♣]/g, '');
                    const suit = card.replace(/[A-Z0-9]/g, '');
                    const suitColor = (suit === '♥' || suit === '♦') ? '#dc3545' : '#333';
                    
                    cardElement.innerHTML = `
                        <div style="
                            width: 100%; 
                            height: 100%; 
                            background: white;
                            border-radius: 8px;
                            border: 1px solid #d1d5db;
                            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                            display: flex;
                            flex-direction: column;
                            align-items: center;
                            justify-content: center;
                            color: ${suitColor};
                            font-size: 3rem;
                            font-weight: bold;
                        ">
                            <div style="font-size: 2rem;">${number}</div>
                            <div style="font-size: 3rem;">${suit}</div>
                        </div>
                    `;
                } else {
                    // Modo cartas - mostrar imágenes reales
                    const { suit, value } = parseRealCard(card);
                    
                    // Mapear palos a símbolos para determinar color
                    let suitSymbol = '';
                    let suitColor = '#333';
                    switch(suit) {
                        case 'spades': suitSymbol = '♠'; suitColor = '#333'; break;
                        case 'hearts': suitSymbol = '♥'; suitColor = '#dc3545'; break;
                        case 'diamonds': suitSymbol = '♦'; suitColor = '#dc3545'; break;
                        case 'clubs': suitSymbol = '♣'; suitColor = '#333'; break;
                    }
                    
                    cardElement.innerHTML = generateCardPattern(value, suitSymbol, suitColor);
                }
                
                cardDisplay.appendChild(cardElement);
            });
            
            // Actualizar indicador de progreso
            document.getElementById('progress').textContent = `Cartas ${startIndex + 1}-${endIndex} de ${cardSequence.length}`;
            
            // Actualizar botones de navegación
            document.getElementById('prev-btn').disabled = startIndex === 0;
            document.getElementById('next-btn').disabled = endIndex >= cardSequence.length;
        }

        // Función para navegar a la página anterior
        function previousCards() {
            if (currentCardIndex > 0) {
                currentCardIndex = Math.max(0, currentCardIndex - 2);
                displayCards();
            }
        }

        // Función para navegar a la página siguiente
        function nextCards() {
            if (currentCardIndex + 2 < cardSequence.length) {
                currentCardIndex = Math.min(cardSequence.length - 2, currentCardIndex + 2);
                displayCards();
            }
        }

        // Función para manejar teclas de navegación
        document.addEventListener('keydown', function(event) {
            if (gameState === 'memorization') {
                if (event.key === 'ArrowLeft') {
                    event.preventDefault();
                    previousCards();
                } else if (event.key === 'ArrowRight') {
                    event.preventDefault();
                    nextCards();
                }
            }
        });

        // Función para actualizar información de cartas
        function updateCardsInfo() {
            const specificMode = document.getElementById('specific-cards-mode').checked;
            const cardsInput = document.getElementById('cards-input');
            const decksInput = document.getElementById('decks-input');
            const selectedInfo = document.getElementById('selected-info');
            const deckInfo = document.getElementById('deck-info');
            
            if (specificMode) {
                cardsMode = 'specific';
                selectedCards = parseInt(cardsInput.value) || 5;
                selectedInfo.textContent = `Memorizarás ${selectedCards} cartas específicas (2 cartas por página)`;
                deckInfo.textContent = 'Total disponible: 52 cartas únicas';
            } else {
                cardsMode = 'decks';
                selectedDecks = parseInt(decksInput.value) || 1;
                selectedCards = selectedDecks * 52;
                selectedInfo.textContent = `Memorizarás ${selectedDecks} baraja(s) completa(s) (${selectedCards} cartas total)`;
                deckInfo.textContent = `Total: ${selectedCards} cartas (${selectedDecks} baraja${selectedDecks > 1 ? 's' : ''})`;
            }
        }

        // Función para actualizar información de rondas
        function updateRoundsInfo() {
            const roundsInput = document.getElementById('rounds-input');
            const roundsInfo = document.getElementById('rounds-info');
            
            totalRounds = parseInt(roundsInput.value) || 10;
            roundsInfo.textContent = `Jugarás ${totalRounds} rondas en total`;
        }

        // Función para actualizar resumen de configuración
        function updateSummary() {
            const summaryCards = document.getElementById('summary-cards');
            const summaryRounds = document.getElementById('summary-rounds');
            const summaryTimers = document.getElementById('summary-timers');
            const summaryMode = document.getElementById('summary-mode');
            
            // Actualizar información de cartas
            if (cardsMode === 'specific') {
                summaryCards.textContent = `Cartas: ${selectedCards}`;
            } else {
                summaryCards.textContent = `Cartas: ${selectedDecks} baraja(s) (${selectedCards} cartas)`;
            }
            
            // Actualizar información de rondas
            summaryRounds.textContent = `Rondas: ${totalRounds}`;
            
            // Actualizar información de temporizadores
            const memorizationMode = document.getElementById('memorization-mode').checked;
            const memorizationTime = parseFloat(document.getElementById('memorization-timer').value) || 15;
            const recallTime = parseFloat(document.getElementById('recall-timer').value) || 30;
            
            summaryTimers.textContent = `Temporizadores: Memorización ${memorizationTime}s, Recall ${recallTime}s`;
            
            // Actualizar información de modo
            if (memorizationMode) {
                summaryMode.textContent = 'Modo: Tiempo de memorización';
            } else {
                const autoAdvanceTime = parseFloat(document.getElementById('auto-advance-time').value) || 3;
                summaryMode.textContent = `Modo: Autoavance (${autoAdvanceTime}s por página)`;
            }
        }

                 // Función para actualizar descripción del modo
         function updateModeDescription() {
             const description = document.getElementById('mode-description');
             const memorizationMode = document.getElementById('memorization-mode').checked;
             const memorizationTime = parseFloat(document.getElementById('memorization-timer').value) || 0;
             const autoAdvanceTime = parseFloat(document.getElementById('auto-advance-time').value) || 0;
             
             if (memorizationMode) {
                 if (memorizationTime > 0) {
                     description.textContent = `El juego usará el tiempo de memorización configurado (${memorizationTime.toFixed(1)} segundos).`;
                 } else {
                     description.textContent = `El juego usará el tiempo de memorización configurado (escribe un tiempo).`;
                 }
             } else {
                 const pages = Math.ceil(selectedCards / 2);
                 if (autoAdvanceTime > 0) {
                     const totalTime = pages * autoAdvanceTime;
                     description.textContent = `El juego avanzará automáticamente cada ${autoAdvanceTime.toFixed(1)} segundos por página (${totalTime.toFixed(1)} segundos total).`;
                 } else {
                     description.textContent = `El juego avanzará automáticamente cada (escribe tiempo) segundos por página.`;
                 }
             }
         }

        // Función para iniciar el juego
        function startGame() {
            // Actualizar configuración con valores actuales
            updateCardsInfo();
            updateRoundsInfo();
            
            // Validar configuración
            if (!validateConfiguration()) {
                return;
            }
            
            // Generar secuencia de cartas
            generateCardSequence();
            
            // Configurar variables de juego
            currentCardIndex = 0;
            gameState = 'memorization';
            
            // Configurar timer según el modo
            const memorizationMode = document.getElementById('memorization-mode').checked;
            if (memorizationMode) {
                currentMode = 'memorization';
                memorizationTime = parseFloat(document.getElementById('memorization-timer').value) || 15;
                timer = memorizationTime;
            } else {
                currentMode = 'auto-advance';
                autoAdvanceTime = parseFloat(document.getElementById('auto-advance-time').value) || 3;
                timer = autoAdvanceTime;
            }
            
            // Cambiar a fase de memorización
            document.getElementById('setup-phase').classList.add('hidden');
            document.getElementById('memorization-phase').classList.remove('hidden');
            
            // Mostrar cartas
            displayCards();
            
            // Registrar tiempo de inicio
            memorizationStartTime = Date.now();
            
            // Actualizar información
            document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
            const memorizationInfo = document.getElementById('memorization-info');
            if (currentMode === 'auto-advance') {
                const totalPages = Math.ceil(cardSequence.length / 2);
                memorizationInfo.textContent = `Ronda ${currentRound} - Página 1 de ${totalPages}. Avanzará automáticamente en ${autoAdvanceTime.toFixed(1)} segundos. Usa ← → para navegar.`;
            } else {
                memorizationInfo.textContent = `Ronda ${currentRound} - Memoriza estas cartas. Tienes ${memorizationTime.toFixed(1)} segundos. Usa ← → para navegar.`;
            }
            
            // Iniciar timer
            startTimer();
        }

        // Función para validar configuración
        function validateConfiguration() {
            const specificMode = document.getElementById('specific-cards-mode').checked;
            const cardsInput = document.getElementById('cards-input');
            const decksInput = document.getElementById('decks-input');
            const roundsInput = document.getElementById('rounds-input');
            const memorizationTimer = document.getElementById('memorization-timer');
            const recallTimer = document.getElementById('recall-timer');
            const autoAdvanceTime = document.getElementById('auto-advance-time');
            
            // Validar número de cartas
            if (specificMode) {
                const cards = parseInt(cardsInput.value);
                if (!cards || cards < 1 || cards > 52) {
                    alert('Por favor, ingresa un número válido de cartas (1-52).');
                    return false;
                }
            } else {
                const decks = parseInt(decksInput.value);
                if (!decks || decks < 1 || decks > 10) {
                    alert('Por favor, ingresa un número válido de barajas (1-10).');
                    return false;
                }
            }
            
            // Validar número de rondas
            const rounds = parseInt(roundsInput.value);
            if (!rounds || rounds < 1 || rounds > 100) {
                alert('Por favor, ingresa un número válido de rondas (1-100).');
                return false;
            }
            
            // Validar temporizadores
            const memorizationMode = document.getElementById('memorization-mode').checked;
            if (memorizationMode) {
                const memorizationTime = parseFloat(memorizationTimer.value);
                if (!memorizationTime || memorizationTime <= 0) {
                    alert('Por favor, ingresa un tiempo válido para memorización.');
                    return false;
                }
            } else {
                const autoAdvance = parseFloat(autoAdvanceTime.value);
                if (!autoAdvance || autoAdvance <= 0) {
                    alert('Por favor, ingresa un tiempo válido para autoavance.');
                    return false;
                }
            }
            
            const recallTime = parseFloat(recallTimer.value);
            if (!recallTime || recallTime <= 0) {
                alert('Por favor, ingresa un tiempo válido para recall.');
                return false;
            }
            
            return true;
        }

        // Función para iniciar timer
        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                timer -= 0.1;
                
                if (timer <= 0) {
                    clearInterval(timerInterval);
                    if (currentMode === 'auto-advance') {
                        // Autoavance - pasar a siguiente página
                        if (currentCardIndex + 2 < cardSequence.length) {
                            nextCards();
                            timer = autoAdvanceTime;
                            startTimer();
                        } else {
                            // Última página - terminar memorización
                            finishMemorization();
                        }
                    } else {
                        // Tiempo de memorización agotado
                        finishMemorization();
                    }
                } else {
                    document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
                }
            }, 100);
        }

        // Función para terminar memorización
        function finishMemorization() {
            if (timerInterval) clearInterval(timerInterval);
            
            // Calcular tiempo real de memorización
            actualMemorizationTime = (Date.now() - memorizationStartTime) / 1000;
            
            // Cambiar a fase de escritura
            gameState = 'input';
            document.getElementById('memorization-phase').classList.add('hidden');
            document.getElementById('input-phase').classList.remove('hidden');
            
            // Configurar inputs para escritura
            setupCardInputs();
            
            // Iniciar timer de recall
            recallTime = parseFloat(document.getElementById('recall-timer').value) || 30;
            timer = recallTime;
            startRecallTimer();
        }

        // Función para configurar inputs de cartas
        function setupCardInputs() {
            const container = document.getElementById('cards-input-container');
            container.innerHTML = '';
            
            // Crear inputs para cada carta
            for (let i = 0; i < cardSequence.length; i++) {
                const cardRow = document.createElement('div');
                cardRow.className = 'card-input-row';
                
                // Input para número/valor de la carta
                const numberInput = document.createElement('input');
                numberInput.type = 'text';
                numberInput.className = 'card-number-select';
                numberInput.placeholder = 'As, Rey, 10...';
                numberInput.dataset.cardIndex = i;
                numberInput.dataset.inputType = 'number';
                
                // Select para palo
                const suitSelect = document.createElement('select');
                suitSelect.className = 'suit-select';
                suitSelect.dataset.cardIndex = i;
                suitSelect.dataset.inputType = 'suit';
                
                // Opciones de palos
                const suits = [
                    { value: '', text: 'Palo' },
                    { value: 'P', text: '♠ Picas' },
                    { value: 'C', text: '♥ Corazones' },
                    { value: 'D', text: '♦ Diamantes' },
                    { value: 'T', text: '♣ Tréboles' }
                ];
                
                suits.forEach(suit => {
                    const option = document.createElement('option');
                    option.value = suit.value;
                    option.textContent = suit.text;
                    suitSelect.appendChild(option);
                });
                
                cardRow.appendChild(numberInput);
                cardRow.appendChild(suitSelect);
                container.appendChild(cardRow);
            }
            
            // Enfocar el primer input
            const firstInput = container.querySelector('.card-number-select');
            if (firstInput) {
                firstInput.focus();
            }
        }

        // Función para iniciar timer de recall
        function startRecallTimer() {
            if (recallTimerInterval) clearInterval(recallTimerInterval);
            
            recallTimerInterval = setInterval(() => {
                timer -= 0.1;
                
                if (timer <= 0) {
                    clearInterval(recallTimerInterval);
                    verifyCardAnswers();
                } else {
                    document.getElementById('recall-timer-display').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
                }
            }, 100);
        }

        // Función para verificar respuestas de cartas
        function verifyCardAnswers() {
            if (recallTimerInterval) clearInterval(recallTimerInterval);
            
            // Inicializar array para guardar respuestas del usuario
            window.userCardResponses = [];
            
            let correctCards = 0;
            const totalCards = cardSequence.length;
            
            console.log('=== VERIFICANDO RESPUESTAS ===');
            console.log('Secuencia original:', cardSequence);
            
            // Verificar cada carta
            for (let i = 0; i < totalCards; i++) {
                const numberInput = document.querySelector(`input[data-card-index="${i}"][data-input-type="number"]`);
                const suitSelect = document.querySelector(`select[data-card-index="${i}"][data-input-type="suit"]`);
                
                if (!numberInput || !suitSelect) {
                    console.log(`❌ No se encontraron inputs para carta ${i + 1}`);
                    continue;
                }
                
                const userNumber = numberInput.value.trim();
                const userSuit = suitSelect.value;
                const originalCard = cardSequence[i];
                
                console.log(`Carta ${i + 1}: Original="${originalCard}", Usuario="${userNumber}${userSuit}"`);
                
                // Guardar respuesta del usuario
                window.userCardResponses.push({
                    cardIndex: i,
                    number: userNumber,
                    suit: userSuit
                });
                
                // Obtener valores esperados
                const expectedValues = getExpectedUserValueFromImage(originalCard);
                const normalizedUserNumber = normalizeUserValue(userNumber);
                const isNumberCorrect = normalizedUserNumber === expectedValues.number.toLowerCase();
                const isSuitCorrect = userSuit === expectedValues.suit;
                const isCardCorrect = isNumberCorrect && isSuitCorrect;
                
                console.log(`  Esperado: ${expectedValues.number}${expectedValues.suit}, Usuario: ${userNumber}${userSuit}, Correcto: ${isCardCorrect}`);
                
                // Aplicar estilos visuales
                if (isCardCorrect) {
                    correctCards++;
                    numberInput.classList.add('correct');
                    suitSelect.classList.add('correct');
                } else {
                    numberInput.classList.add('incorrect');
                    suitSelect.classList.add('incorrect');
                }
            }
            
            // Calcular porcentaje de acierto
            const accuracy = Math.round((correctCards / totalCards) * 100);
            
            // Actualizar puntuación de la ronda
            const roundScore = accuracy === 100 ? 1 : 0;
            roundScores.push(roundScore);
            totalScore += roundScore;
            
            // Guardar estadísticas de la ronda
            if (!window.roundAccuracies) window.roundAccuracies = [];
            if (!window.roundMemTimes) window.roundMemTimes = [];
            
            window.roundAccuracies.push(accuracy);
            window.roundMemTimes.push(actualMemorizationTime);
            
            console.log(`Resultado: ${correctCards}/${totalCards} cartas correctas (${accuracy}%)`);
            console.log('Respuestas guardadas:', window.userCardResponses);
            
            // Mostrar resultado
            showRoundResult(accuracy, correctCards, totalCards);
        }

        // Función para mostrar resultado de la ronda
        function showRoundResult(accuracy, correctCards, totalCards) {
            gameState = 'result';
            document.getElementById('input-phase').classList.add('hidden');
            document.getElementById('result-phase').classList.remove('hidden');
            
            // Actualizar información de la ronda
            document.getElementById('current-round-display').textContent = currentRound;
            document.getElementById('current-round-number').textContent = currentRound;
            document.getElementById('round-number').textContent = currentRound;
            document.getElementById('total-rounds').textContent = totalRounds;
            
            // Actualizar progreso de la ronda
            const progressFill = document.getElementById('round-progress-fill');
            const progressPercentage = (currentRound / totalRounds) * 100;
            progressFill.style.width = progressPercentage + '%';
            
            // Mostrar mensaje de resultado
            const resultMessage = document.getElementById('result-message');
            if (accuracy === 100) {
                resultMessage.textContent = `¡Perfecto! Todas las cartas correctas (${correctCards}/${totalCards})`;
                resultMessage.className = 'result-message correct-result';
            } else {
                resultMessage.textContent = `Respuesta parcialmente correcta: ${correctCards}/${totalCards} cartas (${accuracy}%)`;
                resultMessage.className = 'result-message incorrect-result';
            }
            
            // Actualizar estadísticas de la ronda
            document.getElementById('round-accuracy').textContent = accuracy + '%';
            document.getElementById('round-status').textContent = accuracy === 100 ? 'Correcto' : 'Incorrecto';
            
            // Actualizar clases de color
            const accuracyElement = document.getElementById('round-accuracy');
            const statusElement = document.getElementById('round-status');
            
            accuracyElement.className = `stat-number ${accuracy === 100 ? 'correct' : 'incorrect'}`;
            statusElement.className = `stat-number ${accuracy === 100 ? 'correct' : 'incorrect'}`;
            
            // Actualizar progresión de rondas
            updateRoundResult(accuracy);
            
            // Actualizar estadísticas totales
            updateProgressDisplay();
            
            // Mostrar resultados detallados si es modo cartas
            const gameMode = document.querySelector('input[name="game-mode"]:checked').value;
            if (gameMode === 'cards') {
                showDetailedCardResults();
            }
            
            // Configurar botones según si es la última ronda
            if (currentRound >= totalRounds) {
                document.getElementById('next-round-btn').textContent = 'Ver Resultados Finales';
                document.getElementById('next-round-btn').onclick = showFinalResults;
            }
            
                         // Inicializar configuración de tiempo para siguiente ronda
             initializeResultTimeConfig();
         }

        // Función para mostrar cartas de nuevo
        function showCardsAgain() {
            document.getElementById('input-phase').classList.add('hidden');
            document.getElementById('memorization-phase').classList.remove('hidden');
            
            // Reiniciar a la primera página
            currentCardIndex = 0;
            displayCards();
            
            // Configurar timer de nuevo
            if (currentMode === 'auto-advance') {
                timer = autoAdvanceTime;
            } else {
                timer = memorizationTime;
            }
            
            // Reiniciar tiempo de memorización
            memorizationStartTime = Date.now();
            
            // Actualizar información
            document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
            const memorizationInfo = document.getElementById('memorization-info');
            if (currentMode === 'auto-advance') {
                const totalPages = Math.ceil(cardSequence.length / 2);
                memorizationInfo.textContent = `Ronda ${currentRound} - Página 1 de ${totalPages}. Avanzará automáticamente en ${autoAdvanceTime.toFixed(1)} segundos. Usa ← → para navegar.`;
            } else {
                memorizationInfo.textContent = `Ronda ${currentRound} - Memoriza estas cartas. Tienes ${memorizationTime.toFixed(1)} segundos. Usa ← → para navegar.`;
            }
            
            startTimer();
        }

        // Función completamente nueva para mostrar resultados
        function showDetailedCardResults() {
            const resultContainer = document.getElementById('result-phase');
            
            // Buscar o crear contenedor para resultados detallados
            let detailedResultsContainer = document.getElementById('detailed-card-results');
            if (!detailedResultsContainer) {
                detailedResultsContainer = document.createElement('div');
                detailedResultsContainer.id = 'detailed-card-results';
                detailedResultsContainer.style.cssText = 'margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 10px; border: 2px solid #e9ecef;';
                
                // Insertar después de las estadísticas de la ronda
                const roundStatsGrid = document.getElementById('round-stats-grid');
                if (roundStatsGrid && roundStatsGrid.parentNode) {
                    roundStatsGrid.parentNode.insertBefore(detailedResultsContainer, roundStatsGrid.nextSibling);
                } else {
                    resultContainer.appendChild(detailedResultsContainer);
                }
            }
            
            // Limpiar contenido anterior
            detailedResultsContainer.innerHTML = '';
            
            // Crear título
            const title = document.createElement('h3');
            title.textContent = 'Resultados Detallados de las Cartas';
            title.style.cssText = 'color: #333; margin-bottom: 15px; text-align: center;';
            detailedResultsContainer.appendChild(title);
            
            // Crear tabla de resultados
            const table = document.createElement('table');
            table.style.cssText = 'width: 100%; border-collapse: collapse; margin-top: 10px;';
            
            // Crear encabezado de tabla
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            headerRow.style.cssText = 'background: #007bff; color: white;';
            
            const headers = ['Carta', 'Tu Respuesta', 'Respuesta Correcta', 'Estado'];
            headers.forEach(headerText => {
                const th = document.createElement('th');
                th.textContent = headerText;
                th.style.cssText = 'padding: 10px; text-align: center; border: 1px solid #dee2e6;';
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            // Crear cuerpo de tabla
            const tbody = document.createElement('tbody');
            
            // Leer respuestas guardadas
            const userResponses = window.userCardResponses || [];
            console.log('=== LEYENDO RESPUESTAS PARA RESULTADOS ===');
            console.log('userResponses:', userResponses);
            
            for (let i = 0; i < cardSequence.length; i++) {
                const card = cardSequence[i];
                const userResponse = userResponses.find(r => r.cardIndex === i);
                
                if (!userResponse) {
                    console.log(`❌ No se encontró respuesta para carta ${i + 1}`);
                    continue;
                }
                
                // Usar valores guardados exactamente como se guardaron
                const userNumberRaw = userResponse.number || '';
                const userNumber = userNumberRaw.toLowerCase();
                const userSuit = userResponse.suit || '';
                const expectedValue = getExpectedUserValueFromImage(card);
                
                // Normalizar para mostrar en resultados
                const normalizedUserNumber = normalizeUserValue(userNumber);
                const isNumberCorrect = normalizedUserNumber === expectedValue.number.toLowerCase();
                const isSuitCorrect = userSuit === expectedValue.suit;
                const isCardCorrect = isNumberCorrect && isSuitCorrect;
                
                // Crear fila de tabla
                const row = document.createElement('tr');
                row.style.cssText = isCardCorrect ? 'background: #d4edda;' : 'background: #f8d7da;';
                
                // Columna 1: Carta original
                const cardCell = document.createElement('td');
                cardCell.textContent = `Carta ${i + 1}`;
                cardCell.style.cssText = 'padding: 8px; text-align: center; border: 1px solid #dee2e6; font-weight: bold;';
                row.appendChild(cardCell);
                
                // Columna 2: Respuesta del usuario
                const userResponseCell = document.createElement('td');
                const userResponseText = userNumber && userSuit ? 
                    `${userNumberRaw.toUpperCase()}${suitCodeToIcon(userSuit)}` : 
                    'Sin respuesta';
                userResponseCell.textContent = userResponseText;
                userResponseCell.style.cssText = 'padding: 8px; text-align: center; border: 1px solid #dee2e6;';
                row.appendChild(userResponseCell);
                
                // Columna 3: Respuesta correcta
                const correctResponseCell = document.createElement('td');
                const correctResponseText = `${expectedValue.number.toUpperCase()}${suitCodeToIcon(expectedValue.suit)}`;
                correctResponseCell.textContent = correctResponseText;
                correctResponseCell.style.cssText = 'padding: 8px; text-align: center; border: 1px solid #dee2e6; font-weight: bold;';
                row.appendChild(correctResponseCell);
                
                // Columna 4: Estado
                const statusCell = document.createElement('td');
                let statusText = '';
                let statusColor = '';
                
                if (!userNumber || !userSuit) {
                    statusText = '❌ Incompleto';
                    statusColor = '#dc3545';
                } else if (isCardCorrect) {
                    statusText = '✅ Correcto';
                    statusColor = '#28a745';
                } else {
                    statusText = '❌ Incorrecto';
                    statusColor = '#dc3545';
                }
                
                statusCell.textContent = statusText;
                statusCell.style.cssText = `padding: 8px; text-align: center; border: 1px solid #dee2e6; color: ${statusColor}; font-weight: bold;`;
                row.appendChild(statusCell);
                
                tbody.appendChild(row);
            }
            
            table.appendChild(tbody);
            detailedResultsContainer.appendChild(table);
        }

        // Función para actualizar resultado de ronda
        function updateRoundResult(accuracy) {
            const roundsList = document.getElementById('rounds-percentage-list');
            
            // Crear elemento para esta ronda
            const roundItem = document.createElement('div');
            roundItem.style.cssText = `
                display: inline-block;
                margin: 5px;
                padding: 8px 12px;
                border-radius: 20px;
                font-weight: bold;
                font-size: 0.9rem;
                background: ${accuracy === 100 ? '#d4edda' : '#f8d7da'};
                color: ${accuracy === 100 ? '#155724' : '#721c24'};
                border: 2px solid ${accuracy === 100 ? '#c3e6cb' : '#f5c6cb'};
            `;
            roundItem.textContent = `R${currentRound}: ${accuracy}%`;
            
            roundsList.appendChild(roundItem);
        }

        // Función para actualizar visualización de progreso
        function updateProgressDisplay() {
            // Actualizar estadísticas de la ronda actual
            const roundAccuracy = window.roundAccuracies ? window.roundAccuracies[window.roundAccuracies.length - 1] : 0;
            const roundStatus = roundAccuracy === 100 ? 'Correcto' : 'Incorrecto';
            
            document.getElementById('round-accuracy').textContent = `${roundAccuracy}%`;
            document.getElementById('round-status').textContent = roundStatus;
            
            // Actualizar clases de color
            const accuracyElement = document.getElementById('round-accuracy');
            const statusElement = document.getElementById('round-status');
            
            accuracyElement.className = `stat-number ${roundAccuracy === 100 ? 'correct' : 'incorrect'}`;
            statusElement.className = `stat-number ${roundAccuracy === 100 ? 'correct' : 'incorrect'}`;
            
            // Actualizar estadísticas totales
            document.getElementById('current-score').textContent = totalScore;
            document.getElementById('current-round').textContent = currentRound;
            
            // Calcular promedio de precisión
            const averageAccuracy = window.roundAccuracies && window.roundAccuracies.length > 0 ? 
                Math.round(window.roundAccuracies.reduce((a, b) => a + b, 0) / window.roundAccuracies.length) : 0;
            
            document.getElementById('current-percentage').textContent = `${averageAccuracy}%`;
            
            // Calcular mejor racha
            let currentStreak = 0;
            let bestStreak = 0;
            
            for (let i = roundScores.length - 1; i >= 0; i--) {
                if (roundScores[i] === 1) {
                    currentStreak++;
                    bestStreak = Math.max(bestStreak, currentStreak);
                } else {
                    currentStreak = 0;
                }
            }
            
            document.getElementById('current-streak').textContent = bestStreak;
            
            // Actualizar clases de color para estadísticas totales
            const scoreElement = document.getElementById('current-score');
            const percentageElement = document.getElementById('current-percentage');
            const streakElement = document.getElementById('current-streak');
            
            scoreElement.className = `stat-number ${totalScore > 0 ? 'correct' : 'neutral'}`;
            percentageElement.className = `stat-number ${averageAccuracy > 50 ? 'correct' : 'neutral'}`;
            streakElement.className = `stat-number ${bestStreak > 0 ? 'correct' : 'neutral'}`;
        }

        // Función para inicializar configuración de tiempo en resultados
        function initializeResultTimeConfig() {
            // Copiar valores actuales a los campos de resultado
            document.getElementById('result-memorization-timer').value = memorizationTime || '';
            document.getElementById('result-auto-advance-time').value = autoAdvanceTime || '';
            
            // Configurar eventos para los nuevos campos
            document.getElementById('result-memorization-mode').addEventListener('change', function() {
                if (this.checked) {
                    updateResultModeDescription();
                }
            });
            
            document.getElementById('result-auto-advance-mode').addEventListener('change', function() {
                if (this.checked) {
                    updateResultModeDescription();
                }
            });
            
            document.getElementById('result-memorization-timer').addEventListener('input', function() {
                updateResultModeDescription();
            });
            
            document.getElementById('result-auto-advance-time').addEventListener('input', function() {
                updateResultModeDescription();
            });
            
            updateResultModeDescription();
        }

        // Función para actualizar descripción del modo en resultados
        function updateResultModeDescription() {
            const description = document.getElementById('result-mode-description');
            const memorizationMode = document.getElementById('result-memorization-mode').checked;
            const memorizationTime = parseFloat(document.getElementById('result-memorization-timer').value) || 0;
            const autoAdvanceTime = parseFloat(document.getElementById('result-auto-advance-time').value) || 0;
            
            if (memorizationMode) {
                if (memorizationTime > 0) {
                    description.textContent = `El juego usará el tiempo de memorización configurado (${memorizationTime.toFixed(1)} segundos).`;
                } else {
                    description.textContent = `El juego usará el tiempo de memorización configurado (escribe un tiempo).`;
                }
            } else {
                const pages = Math.ceil(selectedCards / 2);
                if (autoAdvanceTime > 0) {
                    const totalTime = pages * autoAdvanceTime;
                    description.textContent = `El juego avanzará automáticamente cada ${autoAdvanceTime.toFixed(1)} segundos por página (${totalTime.toFixed(1)} segundos total).`;
                } else {
                    description.textContent = `El juego avanzará automáticamente cada (escribe tiempo) segundos por página.`;
                }
            }
        }

        // Función para siguiente ronda
        function nextRound() {
            // Actualizar configuración de tiempo para la siguiente ronda
            const memorizationMode = document.getElementById('result-memorization-mode').checked;
            const newMemorizationTime = parseFloat(document.getElementById('result-memorization-timer').value) || 15;
            const newAutoAdvanceTime = parseFloat(document.getElementById('result-auto-advance-time').value) || 3;
            
            if (memorizationMode) {
                currentMode = 'memorization';
                memorizationTime = newMemorizationTime;
            } else {
                currentMode = 'auto-advance';
                autoAdvanceTime = newAutoAdvanceTime;
            }
            
            // Incrementar ronda
            currentRound++;
            
            // Verificar si es la última ronda
            if (currentRound > totalRounds) {
                showFinalResults();
                return;
            }
            
            // Generar nueva secuencia de cartas
            generateCardSequence();
            currentCardIndex = 0;
            gameState = 'memorization';
            
            // Configurar timer según el modo
            if (currentMode === 'auto-advance') {
                timer = autoAdvanceTime;
            } else {
                timer = memorizationTime;
            }
            
            // Cambiar a fase de memorización
            document.getElementById('result-phase').classList.add('hidden');
            document.getElementById('memorization-phase').classList.remove('hidden');
            
            // Mostrar cartas
            displayCards();
            
            // Registrar tiempo de inicio de memorización
            memorizationStartTime = Date.now();
            
            document.getElementById('timer').textContent = `Tiempo restante: ${timer.toFixed(1)} segundos`;
            
            const memorizationInfo = document.getElementById('memorization-info');
            if (currentMode === 'auto-advance') {
                const totalPages = Math.ceil(cardSequence.length / 2);
                memorizationInfo.textContent = `Ronda ${currentRound} - Página 1 de ${totalPages}. Avanzará automáticamente en ${autoAdvanceTime.toFixed(1)} segundos. Usa ← → para navegar.`;
            } else {
                memorizationInfo.textContent = `Ronda ${currentRound} - Memoriza estas cartas. Tienes ${memorizationTime.toFixed(1)} segundos. Usa ← → para navegar.`;
            }
            
            startTimer();
        }

        // Función para mostrar resultados finales
        function showFinalResults() {
            document.getElementById('result-phase').classList.add('hidden');
            document.getElementById('final-results-phase').classList.remove('hidden');
            
            const correctRounds = roundScores.filter(score => score === 1).length;
            const percentage = Math.round((totalScore / totalRounds) * 100);
            
            // Actualizar estadísticas finales básicas
            document.getElementById('final-score').textContent = `${totalScore}/${totalRounds}`;
            document.getElementById('final-percentage').textContent = percentage + '%';
            document.getElementById('final-streak').textContent = '0'; // Simplificado
            
            console.log('Juego completado!');
        }

        function resetGame() {
            gameState = 'setup';
            currentCardIndex = 0;
            timer = 0;
            cardSequence = [];
            
            // Reiniciar valores por defecto
            selectedCards = 0;
            selectedDecks = 0;
            cardsMode = 'specific';
            memorizationTime = 0;
            recallTime = 0;
            autoAdvanceTime = 0;
            totalRounds = 0;
            
            // Reiniciar arrays de seguimiento de rondas
            roundScores = [];
            totalScore = 0;
            currentRound = 1;
            if (window.roundAccuracies) { window.roundAccuracies = []; }
            if (window.roundMemTimes) { window.roundMemTimes = []; }
            
            document.getElementById('cards-input').value = '';
            document.getElementById('decks-input').value = '';
            document.getElementById('specific-cards-mode').checked = true;
            document.getElementById('full-decks-mode').checked = false;
            document.getElementById('memorization-timer').value = '';
            document.getElementById('recall-timer').value = '';
            document.getElementById('auto-advance-time').value = '';
            document.getElementById('rounds-input').value = '';
            
            // Ocultar conversiones de tiempo
            document.getElementById('memorization-time-conversion').style.display = 'none';
            document.getElementById('recall-time-conversion').style.display = 'none';
            
            // Actualizar información
            updateCardsInfo();
            updateSummary();
             
            document.getElementById('result-phase').classList.add('hidden');
            document.getElementById('final-results-phase').classList.add('hidden');
            document.getElementById('memorization-phase').classList.add('hidden');
            document.getElementById('input-phase').classList.add('hidden');
            document.getElementById('setup-phase').classList.remove('hidden');
             
            if (timerInterval) clearInterval(timerInterval);
            if (recallTimerInterval) clearInterval(recallTimerInterval);
        }

        function goToMenu() {
            resetGame();
        }
        
        // Función para alternar pantalla completa
        function toggleFullscreen() {
            const fullscreenBtn = document.getElementById('fullscreen-btn');
            
            if (!document.fullscreenElement) {
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                } else if (document.documentElement.webkitRequestFullscreen) {
                    document.documentElement.webkitRequestFullscreen();
                } else if (document.documentElement.msRequestFullscreen) {
                    document.documentElement.msRequestFullscreen();
                }
                
                fullscreenBtn.textContent = '⛶';
                fullscreenBtn.title = 'Salir Pantalla Completa';
                fullscreenBtn.classList.add('fullscreen');
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
                
                fullscreenBtn.textContent = '⛶';
                fullscreenBtn.title = 'Pantalla Completa';
                fullscreenBtn.classList.remove('fullscreen');
            }
        }
        
        // Inicialización al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
            updateCardsInfo();
            updateSummary();
            updateProgressDisplay();
            
            // Event listeners para actualizar configuración en tiempo real
            document.getElementById('specific-cards-mode').addEventListener('change', function() {
                updateCardsInfo();
                updateSummary();
            });
            
            document.getElementById('full-decks-mode').addEventListener('change', function() {
                updateCardsInfo();
                updateSummary();
            });
            
            document.getElementById('cards-input').addEventListener('input', function() {
                updateCardsInfo();
                updateSummary();
            });
            
            document.getElementById('decks-input').addEventListener('input', function() {
                updateCardsInfo();
                updateSummary();
            });
            
            document.getElementById('rounds-input').addEventListener('input', function() {
                updateRoundsInfo();
                updateSummary();
            });
            
            document.getElementById('memorization-timer').addEventListener('input', function() {
                updateSummary();
                updateModeDescription();
            });
            
            document.getElementById('recall-timer').addEventListener('input', function() {
                updateSummary();
            });
            
            document.getElementById('auto-advance-time').addEventListener('input', function() {
                updateSummary();
                updateModeDescription();
            });
            
            document.getElementById('memorization-mode').addEventListener('change', function() {
                updateSummary();
                updateModeDescription();
            });
            
            document.getElementById('auto-advance-mode').addEventListener('change', function() {
                updateSummary();
                updateModeDescription();
            });
        });
    </script>
</body>
</html>
